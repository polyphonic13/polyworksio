/*! polyworksjs v0.1.0 2014-08-10 */

function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}!function(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:console.log("----- farkle created: 2014-08-10T12:51:30")}();var PWG={};PWG.Stage=function(){function a(){k.winW=document.documentElement.clientWidth,k.winH=document.documentElement.clientHeight,k.gameH=k.winH>g?g:k.winH,k.gameW=k.winH/f[1]*f[0],k.gameW>k.winW&&(k.gameW=k.winW,k.gameH=k.gameW/f[0]*f[1]),k.gameW-=h,k.gameH-=i,k.unit=k.gameH/f[1],k.gameX=k.winW/2-k.gameW/2,k.gameY=k.winH/2-k.gameH/2,k.gameX+=h,k.gameY+=i;var a=k.winW-80,c=k.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,k.gameW,k.gameH,k.gameX,k.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=k.winW/2-k.gameW/2,c=k.winH/2-k.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=0,i=0,j=!1,k={initialized:!1,winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,j,k,l,m,n,o){"undefined"!=typeof b&&(f=b),"undefined"!=typeof j&&(g=g),"undefined"!=typeof k&&(h=k),"undefined"!=typeof l&&(i=l),d=n,e=o||window,a(),m&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e),this.initialized=!0},sizeGame:function(a){PWG.Game.phaser.scale.maxWidth=a,PWG.Game.phaser.scale.maxHeight=a/f[0]*f[1],PWG.Game.phaser.scale.setSize()},zoomByWidth:function(a,b){var c=a/b.offsetWidth;b.style.zoom=c},zoomByHeight:function(a,b){var c=a/b.offsetHeight;b.style.zoom=c},destroy:function(){j&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return k}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.arraysEqual=function(a,b){if(a===b)return!0;if(null==a||null==b)return!1;if(a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0},a.elementCount=function(a){if(counts={},!Array.isArray(a))return null;var b=a.length;for(i=0;b>i;i++)counts[a[i]]||(counts[a[i]]=0),counts[a[i]]++;return counts},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}();var ViewTypes={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},TilemapTypes={BLANK:"blank",JSON:"json",DATA:"data"};PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PWG.Game.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){if(this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation){{this.animations[a.defaultAnimation]}this.play(a.defaultAnimation)}else b.view.frame=0;this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name;a.physics;PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PWG.Game.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PWG.Game.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.ViewManager=function(){function a(a,b){switch(this.name=b,this.config=a,a.type){case ViewTypes.SPRITE:this.view=PWG.Game.phaser.add.sprite(a.x,a.y,a.img);break;case ViewTypes.TEXT:this.view=PWG.Game.phaser.add.text(a.x,a.y,a.text,a.style);break;case ViewTypes.BUTTON:this.view=PWG.Game.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case ViewTypes.GROUP:this.view=PWG.Game.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0},a.prototype.removeChild=function(a){this.config.type===ViewTypes.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===ViewTypes.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},b.ViewController=a,b.currentGroup="",b.collection={},b.init=function(a){this.collection=this.build(a)},b.build=function(a,b){var b=b||{};return PWG.Utils.each(a,function(a,c){var d=new PWG.ViewManager.ViewController(a,c);a.type===ViewTypes.GROUP&&(d.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(d)),b[a.name]=d},this),b},b.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},b.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},b.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},b.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},b.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},b.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},b.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},b.removeGroupChildren=function(a){var c=b.getControllerFromPath(a);b.removeFromGroup(c.children,c)},b.addViews=function(a,c,d){PWG.Utils.each(a,function(a){b.addView(a,c,d)},this)},b.addView=function(a,b,c){var d=b?b.children:this.collection,e=new PWG.ViewManager.ViewController(a,a.name);return a.type===ViewTypes.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),d[a.name]=e,c&&PWG.ViewManager.initGroup(b),e},b.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},b.showView=function(a){var b=this.getControllerFromPath(a);b.show()},b.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},b.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},b.swapDepths=function(a){this.getControllerFromPath(a)},b.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},b.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},b.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},b.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},b}(),PWG.TilemapManager=function(){function a(a){trace("TilemapController/constructor, config = ",a),this.config=a,this.layers={},this.map=null,this.map=PWG.Game.phaser.add.tilemap(a.json),PWG.Utils.each(a.tilesets,function(a){trace("	adding tileset image: "+a),this.map.addTilesetImage(a)},this),PWG.Utils.each(a.layers,function(a,b){trace("	adding layer["+b+"]: ",a),this.layers[b]=this.map.createLayer(b),a.attrs&&PWG.Utils.extend(this.layers[b],a.attrs)},this)}var b={};return a.prototype.addImage=function(a){this.config.type===TilemapTypes.DATA?(trace("	adding image: "+a),this.map.addTilesetImage(a)):this.config.type===TilemapTypes.JSON&&(trace("	adding image: "+a.jsonName+"/"+a.reference),this.map.addTilesetImage(a.jsonName,a.reference))},a.prototype.addLayers=function(a){PWG.Utils.each(a,function(a,b){trace("	adding layer["+b+"]: ",a),this.config.type===TilemapTypes.DATA?(this.layers[b]=this.map.createBlankLayer(b,a.width,a.height,a.tileW,a.tileH,a.group),a.tiles&&this.addTiles(a.data.getTileConfig(b),layer)):this.config.type===TilemapTypes.JSON&&(this.layers[b]=this.map.createLayer(b)),a.attrs&&(trace("ADDING ATTRIBUTES TO LAYER: "+b+": ",a.attrs),PWG.Utils.extend(this.layers[b],a.attrs)),a.resizeWorld&&this.layers[b].resizeWorld()},this)},a.prototype.addTiles=function(a,b){PWG.Utils.each(a,function(a){this.map.putTile(a.imgIndex,a.xCell,this.yCell,b)},this)},b.TilemapController=a,b.build=function(b){trace("TilemapManager/build, map = ",b);var c=[];return PWG.Utils.each(b,function(b){c.push(new a(b))},this),c},b}(),PWG.StateManager=function(){function a(a,b){trace("StateController["+a+"]/constructor, state = ",b),this.name=a,PWG.Utils.extend(this,b),this.preloaded=!1,PWG.Game.phaser.state.add(this.name,this,!1)}var b={};return a.prototype.start=function(){trace("StateController["+this.name+"]/start"),this.methods.start&&this.methods.start.call(this)},a.prototype.preload=function(){trace("StateController["+this.name+"]/preload, preloaded = "+this.preloaded+"\n	this = ",this),this.preloaded||(PWG.PhaserLoader.load(this.config.assets),this.preloaded=!0)},a.prototype.create=function(){trace("StateController["+this.name+"]/create, this.config = ",this.config);var a=this.config.world;trace("setting world bounds to: x/y = "+a.x+"/"+a.y+", w/h = "+a.width+"/"+a.height),PWG.Game.phaser.world.setBounds(a.x,a.y,a.width,a.height),this.config.views.background&&(this.views=PWG.ViewManager.build(this.config.views.background)),this.config.tilemaps&&(this.tilemaps=PWG.TilemapManager.build(this.config.tilemaps)),this.config.views.foreground&&(this.views=PWG.ViewManager.build(this.config.views.foreground)),trace("post method add, this = ",this),this.listeners&&PWG.EventCenter.batchBind(this.listeners,this),this.methods.create&&this.methods.create.call(this)},a.prototype.update=function(){this.methods.update&&this.methods.update.call(this),this.inputs&&PWG.Utils.each(this.inputs,function(a){a.update&&a.update()},this),this.tilesMaps&&PWG.PhaserTilemap.update(this.tilemaps),PWG.PhaserInput.updateKeyboard()},a.prototype.getView=function(a){return trace("StateController["+this.name+"]/getView, id = "+a),this.views.hasOwnProperty(a)?this.views[a]:void 0},a.prototype.shutdown=function(){trace("StateController["+this.name+"]/shutdown"),this.methods.shutdown&&this.methods.shutdown.call(this),PWG.Utils.each(this.views,function(a,b){a.destroy(),delete this.views[b]},this),this.listeners&&PWG.EventCenter.batchUnbind(this.listeners,this)},b.StateController=a,b.init=function(a){trace("StateManager/init, config = ",a),this.states={},this.currentId="",PWG.Utils.each(a,function(a,b){a.config=PWG.Game.config.states[b],trace("	adding state["+b+"] = ",a),this.states[b]=new this.StateController(b,a)},this),trace("	end of init, states = ",this.states),PWG.EventCenter.bind(PWG.Events.CHANGE_STATE,b.onChangeState,b)},b.onChangeState=function(a){b.changeState(a.value)},b.changeState=function(a){trace("StateManager/changeState, id = "+a+", currentId = "+this.currentId+", states = ",this.states),this.currentId!==a&&this.states.hasOwnProperty(a)&&(this.currentId=a,PWG.Game.phaser.state.start(a,this.states[a].clearWorld,this.states[a].clearCache))},b.getCurrentStateGroup=function(){return trace("StateManager/getCurrentStateGroup, currentId = "+this.currentId+", views = ",this.states[this.currentId].views),this.states[this.currentId].views["state-group"].view},b.getView=function(a){return trace("StateManager/getView, id = "+a),this.state[this.currentId].getView()},b.destroy=function(){PWG.EventCenter.unbind(PWG.Events.CHANGE_STATE,b.changeState,b),this.states[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PWG.Game.phaser.input.mousePointer),this.dragCamera(PWG.Game.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PWG.Game.phaser.camera.x+=this.camera.x-a.position.x,PWG.Game.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PWG.Game.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PWG.Game.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PWG.Game.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PWG.Game.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PWG.Game.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PWG.Game.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){trace("Loader/_initAssets, this = ",this),PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{},audio:{}},d.init=function(d,e){trace("PhaserLoader/init, config = ",d),b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps"),a(d.audio,"audio")},d.load=function(a){if(trace("PhaserLoader/load, assets = ",a),a.images){var b=PWG.Game.config.assets.images;trace("	images = ",b),PWG.Utils.each(a.images,function(a){this.loaded.images[a]||(trace("	------- loading: image = "+a+", url = "+b[a]),c.load.image(a,b[a]),this.loaded.images[a]=!0)},this)}if(a.sprites){var d=PWG.Game.config.assets.sprites;PWG.Utils.each(a.sprites,function(a){if(!this.loaded.sprites[a]){trace("	loading: sprite = "+a+", url = "+d[a].url);var b=d[a];c.load.spritesheet(a,b.url,b.width,b.height),this.loaded.sprites[a]=!0}},this)}if(a.tilemaps){var e=PWG.Game.config.assets.tilemaps;PWG.Utils.each(a.tilemaps,function(a){if(!this.loaded.tilemaps[a]){trace("	loading: tilemap = "+a+", url = "+e[a].url);var b=e[a];c.load.tilemap(a,b.url,null,b.type)}},this)}},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}(),PWG.Game=function(){function a(){trace("PWG.Game/onStageInitialized"),h.loadingAnimation&&l.addLoadingAnimation(),h.init(b,l)}function b(a){l.config=a,trace("PWG.Game/onConfigInitalized, config = ",a,"	module = ",l),j=!0,PWG.Utils.extend(l,i.global.methods),PWG.EventCenter.batchBind(i.global.listeners,l),l.phaser=new Phaser.Game(l.config.canvasW,l.config.canvasH,Phaser.AUTO,l.config.gameEl,{preload:c,create:d,update:e,render:f})}function c(){trace("PWG.Game/_preload, module = ",l),PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function d(){trace("PWG.Game/_create"),h.loadingAnimation&&l.removeLoadingAnimation(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.global.views),PWG.StateManager.init(i.states),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function e(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function f(){l.render&&l.render.call(this)}function g(){k=!0,PWG.EventCenter.batchUnbind(i.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var h,i,j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){trace("PWG.Game/init, gameConfig = ",b,"	gameLogic = ",c),h=b,i=c,l.stage=PWG.Stage,l.stage.init(b.aspectRatio,b.maxHeight,b.offsetX,b.offsetY,b.resizable,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.addLoadingAnimation=function(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)},l.removeLoadingAnimation=function(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)},l.quit=function(){k||g()},l}();var Farkle=function(){function a(a){this.idx=a,this.value=-1,this.score=0,this.scorable=!1,this.groupId="",this.active=!0,this.selected=!1}function b(a){this.availableDice=a,this.collection=[],this.throwScores=[],this.totalScore=0,this.usedDice=0;for(var b=0;a>b;b++)this.collection.push(new Farkle.Die(b))}var c={};return c.NUM_DICE=6,c.MIN_TURN_SCORE=300,c.STRAIGHT_SCORE=1500,c.FULL_HOUSE_SCORE=750,c.ONE_TRIPLE_MULTIPLIER=1e3,c.TRIPLE_MULTIPLIER=100,c.FIVE_SCORE=50,c.ONE_SCORE=100,c.TRIPLE_FARKLE=500,c.WINNING_SCORE=1e4,a.prototype.roll=function(){this.value=PWG.Utils.diceRoll()},a.prototype.setActive=function(a){this.active=a,this.groupId=""},b.prototype.roll=function(){PWG.Utils.each(this.collection,function(a){a.active&&a.roll()},this)},b.prototype.getActive=function(){var a=[];return PWG.Utils.each(this.collection,function(b){b.active&&a.push(b)},this),a},b.prototype.getActiveValues=function(){var a=[];return PWG.Utils.each(this.collection,function(b){b.active&&a.push(b.value)},this),a},b.prototype.setAllActive=function(){PWG.Utils.each(this.collection,function(a){a.setActive(!0)},this)},b.prototype.resetGroupIds=function(){PWG.Utils.each(this.collection,function(a){a.groupId=""},this)},b.prototype.parseCurrentRoll=function(){var a=this.getActive();if(this.groups=[],this.hotDice=!1,this.farkled=!0,this.scoringDice=0,Farkle.straightTest(this.getActiveValues()))this.hotDice=!0,this.farkled=!1,this.scoringDice=6,this.setAllScorable("straight"),this.groups.push("straight");else{var b={1:[],2:[],3:[],4:[],5:[],6:[]};PWG.Utils.each(a,function(a){b[a.value].push(a)},this);var c=0,d=0;PWG.Utils.each(b,function(a,b){a.length>=3?(this.farkled=!1,this.groups.push("triple"+b),d++,PWG.Utils.each(a,function(a){this.scoringDice++,a.scorable=!0,1!==parseInt(b)&&5!==parseInt(b)&&(a.groupId="triple"+b)},this)):2==a.length&&c++},this),3===c?(this.setAllScorable("fullHouse"),this.groups.push("fullHouse"),this.farkled=!1,this.hotDice=!0,this.scoringDice=6):2===d&&(this.hotDice=!0),b[1].length>0&&b[1].length<3&&(this.farkled=!1,this.parseOnesAndFives(b,1)),b[5].length>0&&b[5].length<3&&(this.farkled=!1,this.parseOnesAndFives(b,5)),6===this.scoringDice&&(this.hotDice=!0)}},b.prototype.parseOnesAndFives=function(a,b){PWG.Utils.each(a[b],function(a){a.scorable=!0,this.scoringDice++},this)},b.prototype.setAllScorable=function(a){this.hotDice=!0,PWG.Utils.each(this.collection,function(b){b.scorable=!0,a&&(b.groupId=a)},this)},b.prototype.bankScoringDice=function(a){{var b=0,c={},d=0,e=0;PWG.Utils.objLength(a)}for(var f in a){var g=this.collection[a[f]];if(""!==g.groupId){if("straight"===g.groupId){b+=Farkle.STRAIGHT_SCORE,this.setAllActive(!1),this.usedDice+=6;break}if("fullHouse"===g.groupId){b+=Farkle.FULL_HOUSE_SCORE,this.setAllActive(!1),this.usedDice+=6;break}c[g.value]||(c[g.value]=0),c[g.value]++,g.setActive(!1),this.availableDice--,this.usedDice++}else 1===g.value?(d++,g.setActive(!1),this.availableDice--,this.usedDice++):5===g.value&&(e++,g.setActive(!1),this.availableDice--,this.usedDice++)}PWG.Utils.each(c,function(a,c){b+=(a-2)*c*Farkle.TRIPLE_MULTIPLIER},this),d>0&&(b+=d>=3?(d-2)*Farkle.ONE_TRIPLE_MULTIPLIER:d*Farkle.ONE_SCORE),e>0&&(b+=e>=3?5*(e-2)*Farkle.TRIPLE_MULTIPLIER:e*Farkle.FIVE_SCORE),this.totalScore+=b,this.throwScores.push(b),this.resetGroupIds(),this.hotDice=this.usedDice%6===0?!0:!1,0===this.availableDice&&(this.availableDice=Farkle.NUM_DICE,this.setAllActive(!0)),trace("TurnDice/bankScoringDice\n	score = "+b+"	throwScores now: "+this.throwScores+"\n	turn score: "+this.totalScore+"\n	available = "+this.availableDice+"\n	usedDice = "+this.usedDice,this)},b.prototype.destroy=function(){PWG.Utils.each(this.collection,function(a,b){delete this.collection[b]},this),this.collection=null},c.Die=a,c.TurnDice=b,c.straight=[1,2,3,4,5,6],c.init=function(a,b){this.callback=a,this.ctx=b||window},c.startTurn=function(){this.turnDice=new Farkle.TurnDice(Farkle.NUM_DICE)},c.roll=function(){this.turnDice.roll(),this.turnDice.parseCurrentRoll(),this.callback&&this.callback.call(this.ctx)},c.rollStraight=function(){this.turnDice.collection[0].value=1,this.turnDice.collection[1].value=2,this.turnDice.collection[2].value=3,this.turnDice.collection[3].value=4,this.turnDice.collection[4].value=5,this.turnDice.collection[5].value=6,this.turnDice.parseCurrentRoll(),this.callback&&this.callback.call(this.ctx)
},c.rollFullHouse=function(){this.turnDice.collection[0].value=2,this.turnDice.collection[1].value=2,this.turnDice.collection[2].value=3,this.turnDice.collection[3].value=3,this.turnDice.collection[4].value=6,this.turnDice.collection[5].value=6,this.turnDice.parseCurrentRoll(),this.callback&&this.callback.call(this.ctx)},c.rollDoubleTrips=function(){this.turnDice.collection[0].value=2,this.turnDice.collection[1].value=2,this.turnDice.collection[2].value=2,this.turnDice.collection[3].value=6,this.turnDice.collection[4].value=6,this.turnDice.collection[5].value=6,this.turnDice.parseCurrentRoll(),this.callback&&this.callback.call(this.ctx)},c.checkScoringDice=function(a){var b={score:0,dice:[]};if(Farkle.straightTest(a))b.score=Farkle.STRAIGHT_SCORE,b.dice=a;else{var c=PWG.Utils.elementCount(a),d=[],e={};for(var f in c)c[f]>=3?(e[f]=c[f],delete c[f]):2===c[f]&&d.push(f);if(3===d.length)b.score=Farkle.FULL_HOUSE_SCORE,b.dice=a;else{if(PWG.Utils.objLength(e)>0&&PWG.Utils.each(e,function(a,c){var d=1===parseInt(c)?Farkle.ONE_TRIPLE_MULTIPLIER:Farkle.TRIPLE_MULTIPLIER;b.score+=c*d*(a-2);for(var e=0;a>e;e++)b.dice.push(c)},this),c[1]&&c[1]<3)for(b.score+=c[1]*Farkle.ONE_SCORE;c[1].length>0;)b.dice.push(1),c[1].pop();if(c[5]&&c[5]<3)for(b.score+=c[5]*Farkle.FIVE_SCORE;c[5].length>0;)b.dice.push(5),c[5].pop()}}return b},c.bankScoringDice=function(a){return this.turnDice.bankScoringDice(a),this.turnDice.throwScores},c.straightTest=function(a){var b=!1,c=a.length;if(6===c){var d=PWG.Utils.elementCount(a);1===d[1]&&1===d[2]&&1===d[3]&&1===d[4]&&1===d[5]&&1===d[6]&&(b=!0)}return b},c.quit=function(){trace("Farkle/quit"),this.turnDice.destroy(),this.turnDice=null},c}(),FlatGUI=function(){function a(a,d,e,h,i,j,k){var l="";if(this.idx=a,this.id=e,this.value=d,this.selected=!1,this.scorable=j,this.groupId=k,this.el=document.createElement("div"),this.el.className="die die_"+d,this.el.setAttribute("id",e),l="width: "+c+"px;",l+="height: "+c+"px;",h.appendChild(this.el),i){var m=a*b+7*g.unit;if(l+="left:"+m+"px;",g.randomPositions){var n;n=Math.floor(0===a||5===a?Math.random()*(g.rollingGreenRect.height-(b+g.playScreenRect.height/6+10*g.unit)):Math.random()*(g.rollingGreenRect.height-b)+3*g.unit),l+="top:"+n+"px;"}if(g.randomRotations){var o=360*Math.random(),p=PWG.Utils.parseMarkup(f,{rotation:o});l+=p}j&&(this.el.className+=" selectable_die",this.el.addEventListener("click",function(){g.selectDie(e)}))}else l+="left:"+a*b+"px;",l+="top:0px;";this.el.setAttribute("style",l)}var b,c,d=!1,e='<div id="player_title_~{name}~" class="player_title">~{name}~</div><div  id="turn_score_~{name}~" class="turn_score text_md">turn: 0</div><div  id="total_score_~{name}~" class="total_score text_md">total: 0</div><div id="farkles_~{name}~" class="current_farkles text_md text_red"></div>',f=" transform:rotate(~{rotation}~deg);-ms-transform:rotate(~{rotation}~deg);-webkit-transform:rotate(~{rotation}~deg);",g={};return g.GUIDie=a,g.rolledDice={},g.playerEls={},g.quitCb=null,g.button1Callback=null,g.configBoxOpen=!1,g.randomPositions=!0,g.randomRotations=!0,g.init=function(a,b){g.quitCallback=b,g.currentScreen="home",g.titleButton=document.getElementById("title"),g.titleButton.addEventListener("click",g.onTitleClick),g.homeScreen=document.getElementById("home_screen"),g.onePlayer=document.getElementById("one_player"),g.twoPlayers=document.getElementById("two_players"),g.threePlayers=document.getElementById("three_players"),g.fourPlayers=document.getElementById("four_players"),g.onePlayer.addEventListener("click",g.onOnePlayerStart),g.twoPlayers.addEventListener("click",g.onTwoPlayerStart),g.threePlayers.addEventListener("click",g.onThreePlayerStart),g.fourPlayers.addEventListener("click",g.onFourPlayerStart),g.tutorialScreen=document.getElementById("tutorial_screen"),g.tutorialButton=document.getElementById("tutorial"),g.tutorialButton.addEventListener("click",g.onTutorialClick),g.playScreen=document.getElementById("play_screen"),g.rollingGreen=document.getElementById("rolling_green"),g.infoArea=document.getElementById("info"),g.updateText("infoArea","choose players"),g.button1=document.getElementById("button1"),g.button2=document.getElementById("button2"),g.button1.addEventListener("click",g.onButton1Click),g.button2.addEventListener("click",g.onButton2Click),g.button1Callback=a,g.setButton(g.button1,"start"),g.layout(),window.addEventListener("resize",g.layout)},g.onTitleClick=function(){if("home"!==g.currentScreen)switch(g.currentScreen){case"play":Game.quit();break;case"tutorial":g.closeScreen("tutorial");break;default:trace("unknown screen: "+g.currentScreen)}},g.confirmQuit=function(a){trace("FlatGUI/confirmQuit"),g.configBoxOpen=!0,g.confirmQuitCb=a;var b=document.getElementById("confirm_box");b.style.display="block",g.updateOrientationClasses(b,"screen");var c=document.getElementById("cancel_button"),d=document.getElementById("confirm_button");c.addEventListener("click",g.onCancelQuitClicked),d.addEventListener("click",g.onConfirmQuitClicked)},g.onCancelQuitClicked=function(){trace("FlatGUI/cancelQuit"),g.confirmQuitCb.call(this,!1),g.closeConfirmBox()},g.onConfirmQuitClicked=function(){g.confirmQuitCb.call(this,!0),g.closeConfirmBox()},g.closeConfirmBox=function(){trace("FlatGUI/closeConfirmBox");var a=document.getElementById("confirm_box");a.style.display="none";var b=document.getElementById("cancel_button"),c=document.getElementById("cancel_button");b.removeEventListener("click",g.cancelQuit),c.removeEventListener("click",g.confirmQuit),g.configBoxOpen=!1},g.onTutorialClick=function(){g.currentScreen="tutorial",g.tutorialScreen.style.display="block",g.tutorialScreen.className+=" animation_left_onto_screen",g.backButton=document.getElementById("back_button"),g.backButton.addEventListener("click",g.onBackButtonClick),g.updateText("infoArea","rules")},g.onBackButtonClick=function(){g.closeScreen("tutorial")},g.closeScreen=function(a){var b=g[a+"Screen"],c=b.className;b.className=c.substr(0,c.indexOf(" animation_left_onto_screen")),b.style.display="none",g.updateText("infoArea","choose players"),g.currentScreen="home"},g.onOnePlayerStart=function(){g.playerNumberSelected(1)},g.onTwoPlayerStart=function(){g.playerNumberSelected(2)},g.onThreePlayerStart=function(){g.playerNumberSelected(3)},g.onFourPlayerStart=function(){g.playerNumberSelected(4)},g.playerNumberSelected=function(a){g.updateText("infoArea",""),Game.initPlayers(a)},g.initGame=function(){g.currentScreen="play",g.playScreen.style.display="block",g.playScreen.className+=" animation_left_onto_screen",g.playScreenRect=g.playScreen.getBoundingClientRect(),g.rollingGreenRect=g.rollingGreen.getBoundingClientRect(),g.bank=document.getElementById("bank")},g.startGame=function(a){trace("FlatGUI/startGame"),g.addPlayerEls(a),g.unit=g.playScreen.offsetWidth/100,d=!0},g.addPlayerEls=function(a){var b=document.getElementById("players");PWG.Utils.each(a,function(a){var c=document.createElement("div");c.setAttribute("id",a.name);var d=PWG.Utils.parseMarkup(e,a);c.innerHTML=d,c.className="player",c.style.opacity=.5,g.playerEls[a.name]=c,b.appendChild(c)},this)},g.removePlayerEls=function(){var a=document.getElementById("players");PWG.Utils.each(g.playerEls,function(b,c){a.removeChild(b),delete g.playerEls[c]},this)},g.startTurn=function(a){g.switchPlayerEl(a.name),g.usedThisTurn=0,g.removeDice(g.rolledDice),g.rolledDice={},g.removeDice(g.selectedDice),g.selectedDice={},g.updateText("infoArea",""),g.updateText("turnScore",0),g.updateText("totalScore",a.score)},g.switchPlayerEl=function(a){g.playerTitle=document.getElementById("player_title_"+a),g.totalScore=document.getElementById("total_score_"+a),g.turnScore=document.getElementById("turn_score_"+a),g.farklesText=document.getElementById("farkles_"+a),PWG.Utils.each(g.playerEls,function(b,c){b.style.opacity=c===a?1:.33},this)},g.startRoll=function(a){g.removeDice(g.rolledDice),g.toSelect={},g.selecting=!1,g.button1Callback=a,g.setButton(g.button1,"roll")},g.endTurn=function(a){g.updateText("totalScore",a.score),g.setFarkleText(a)},g.setButton=function(a,b){a.innerHTML=b,g.showButton(a)},g.onButton1Click=function(){g.button1Callback.call(this)},g.onButton2Click=function(){g.hideButton(g.button2),g.button2Callback.call(this)},g.hideButton=function(a){a.style.visibility="hidden"},g.showButton=function(a){a.style.visibility="visible"},g.displayRoll=function(b){g.setButton(g.button1,"bank"),g.button1Callback=g.onSelectionComplete,g.selecting=!1,g.updateText("infoArea",""),PWG.Utils.each(b.collection,function(b,c){if(b.active){var d="rolledDie"+c+"-"+String((new Date).getTime())+"-"+String(Math.floor(999*Math.random())),e=new a(c,b.value,d,g.rollingGreen,!0,b.scorable,b.groupId);g.rolledDice[d]=e}},this)},g.selectDie=function(a){var b=g.rolledDice[a];b.selected?(b.el.style.opacity=1,b.selected=!1,g.removeSelectedDie(b),""!==b.groupId&&PWG.Utils.each(g.rolledDice,function(a){a.groupId===b.groupId&&(a.el.style.opacity=1,a.selected=!1,g.removeSelectedDie(a))},this)):(b.el.style.opacity=.5,b.selected=!0,g.addSelectedDie(b),""!==b.groupId&&PWG.Utils.each(g.rolledDice,function(a){a.groupId===b.groupId&&(a.el.style.opacity=.5,a.selected=!0,g.addSelectedDie(a))},this))},g.addSelectedDie=function(a){g.toSelect[a.id]=a.idx},g.removeSelectedDie=function(a){delete g.toSelect[a.id]},g.setSelectedCallback=function(a){g.selectedCb=a},g.onSelectionComplete=function(){g.selecting=!0,PWG.Utils.each(g.toSelect,function(b,c){var d=g.rolledDice[c],e=new a(PWG.Utils.objLength(g.selectedDice),d.value,"selectedDie"+d.id,g.bank);g.selectedDice[d.id]=e,g.usedThisTurn++},g);var b=PWG.Utils.objLength(g.toSelect);b>0&&(g.usedThisTurn%6===0&&g.showHotDice(),g.selectedCb&&g.selectedCb.call(this,g.toSelect))},g.showHotDice=function(){g.updateText("infoArea","HOT DICE!")},g.farkled=function(a,b){g.updateText("turnScore","0"),g.updateText("infoArea","FARKLE!"),g.setFarkleText(b),g.hideButton(g.button1),g.button2Callback=a,g.setButton(g.button2,"next")},g.setFarkleText=function(a){for(var b="",c=0;c<a.currentFarkles;c++)b+="F ";g.updateText("farklesText",b)},g.removeDice=function(a){PWG.Utils.each(a,function(b){g.removeDie(b,a)},this)},g.removeDie=function(a,b){a.el.parentNode.removeChild(a.el),delete b[a.id]},g.updateText=function(a,b){var c="";if("turnScore"===a?c="turn: ":"totalScore"===a&&(c="total: "),this[a].innerHTML=c+b,"farklesText"!==a)if("FARKLE!"===b){var d=this[a].className.indexOf(" text_red");-1===d&&(this[a].className+=" text_red")}else{var d=this[a].className.indexOf(" text_red");if(d>-1){var e=this[a].className.substr(0,d);this[a].className=e}}},g.showEndTurnButton=function(a){g.setButton(g.button2,"next"),g.button2Callback=a},g.gameOver=function(a,b){g.updateText("infoArea",b.name+" WINS!"),g.button1Callback=a,g.setButton(g.button1,"play again"),g.button2Callback=Game.quit,g.setButton(g.button2,"quit")},g.cleanUp=function(){g.selecting=!1,g.button1Callback=null,g.removeDice(g.selectedDice),g.removePlayerEls(),g.selectedDice={}},g.layout=function(){var a,e=document.documentElement.clientWidth,f=document.documentElement.clientHeight;e>f?(g.orientation="landscape",a=f):(g.orientation="portrait",a=e);var h=document.getElementById("title_and_info");g.updateOrientationClasses(h,"title_and_info");var i=document.getElementById("players");if(g.updateOrientationClasses(i,"players"),g.updateOrientationClasses(g.homeScreen,"screen"),g.updateOrientationClasses(g.playScreen,"screen"),g.updateOrientationClasses(g.tutorialScreen,"screen"),g.confirmBoxOpen){var j=document.getElementById("confirm_box");g.updateOrientationClasses(j,"screen")}b=a/6*.9,c=Math.sqrt(Math.pow(b,2)/2),d&&(g.playScreenRect=g.playScreen.getBoundingClientRect(),g.rollingGreenRect=g.rollingGreen.getBoundingClientRect(),g.unit=g.playScreen.offsetWidth/100,PWG.Utils.objLength(g.rolledDice)&&g.resizeDice(g.rolledDice,!0),PWG.Utils.objLength(g.selectedDice)&&g.resizeDice(g.selectedDice,!1))},g.updateOrientationClasses=function(a,b){var c=a.className.substr(0,b.length),d=c+" "+b+"_"+g.orientation;a.className=d},g.resizeDice=function(a,d){PWG.Utils.each(a,function(a){var e=a.el.getAttribute("style"),f=e.substr(e.indexOf("top"),e.length),h="width:"+c+"px;height:"+c+"px;"+f;if(d){var i=a.idx*b+7*g.unit;h+="left:"+i+"px;"}else h+="left:"+a.idx*b+"px;";a.el.setAttribute("style",h)},this)},g.quit=function(a){trace("FlatGUI/quit"),g.removePlayerEls(),g.closeScreen("play"),g.removeDice(g.rolledDice),g.rolledDice={},g.removeDice(g.selectedDice),g.selectedDice={},g.button1Callback=a,g.setButton(g.button1,"start"),g.hideButton(g.button2)},g}(),Game=function(){function a(a){PWG.Utils.extend(this,a),this.score=0,this.currentFarkles=0}var b={};return a.prototype.reset=function(){this.score=0,this.currentFarkles=0},a.prototype.printDetails=function(){PWG.Utils.each(this,function(a,b){this.hasOwnProperty(b)},this)},b.Player=a,b.gameActive=!1,b.players=[],b.currentPlayer=-1,b.totalRounds=0,b.init=function(a){b.gui=a,b.players=[],Farkle.init(b.onRolled,this),b.gui.init(b.startGame,b.quit)},b.initPlayers=function(c){for(var d=0;c>d;d++)b.players.push(new a({name:"player"+(d+1)}));b.gui.initGame(b.players)},b.startGame=function(){trace("Game/startGame"),b.gameActive=!0,b.gui.startGame(b.players),b.currentPlayer=0,b.totalRounds=1,b.startTurn()},b.startTurn=function(){trace("Game/startTurn"),b.gui.startTurn(b.players[b.currentPlayer]),Farkle.startTurn(),Game.startRoll()},b.startRoll=function(){b.gui.startRoll(Game.onRollClicked)},b.onRollClicked=function(){Farkle.roll()},b.onRolled=function(){b.gui.displayRoll(Farkle.turnDice),b.gui.setSelectedCallback(b.onDiceSelected),Farkle.turnDice.farkled&&b.showFarkled()},b.onDiceSelected=function(a){var c=[];c=Farkle.bankScoringDice(a);var d=0;Farkle.turnDice.hotDice&&b.gui.showHotDice(),c instanceof Array?PWG.Utils.each(c,function(a){d+=a},this):d=c,b.gui.updateText("turnScore",d),d>=Farkle.MIN_TURN_SCORE&&(Game.farkled=!1,b.gui.showEndTurnButton(Game.endTurn)),Game.startRoll()},b.showFarkled=function(){Game.farkled=!0,b.players[b.currentPlayer].currentFarkles++,b.gui.farkled(Game.endTurn,b.players[b.currentPlayer])},b.endTurn=function(){Game.farkled?b.players[b.currentPlayer].currentFarkles>=3&&(b.players[b.currentPlayer].score-=Farkle.TRIPLE_FARKLE,b.players[b.currentPlayer].currentFarkles=0):(b.players[b.currentPlayer].currentFarkles=0,b.players[b.currentPlayer].score+=Farkle.turnDice.totalScore),b.gui.endTurn(b.players[b.currentPlayer]),b.players[b.currentPlayer].score>=Farkle.WINNING_SCORE?b.gameOver():b.switchPlayer()},b.switchPlayer=function(){b.currentPlayer<b.players.length-1?b.currentPlayer++:(b.currentPlayer=0,b.totalRounds++),b.startTurn()},b.gameOver=function(){b.gui.gameOver(Game.restart,b.players[b.currentPlayer])},b.quit=function(){trace("Game/quit, gameActive = "+b.gameActive),b.gameActive&&b.gui.confirmQuit(b.confirmQuit)},b.confirmQuit=function(a){a&&(b.gameActive=!1,b.currentPlayer=-1,b.totalRounds=0,b.players=[],b.gui.quit(b.startGame),Farkle.quit())},b.restart=function(){PWG.Utils.each(b.players,function(a){a.reset()},this),b.gui.cleanUp(),b.startGame()},b}();
//# sourceMappingURL=farkle.min.js.map