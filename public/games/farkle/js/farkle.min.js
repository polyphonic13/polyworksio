/*! polyworksjs v0.1.0 2015-03-21 */

function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}!function(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:console.log("----- farkle created: 2015-03-21T09:56:23")}();var PWG=PWG||{};PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=0,e=a.length;e>d;d++)b.call(c,a[d],d,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){var b=a.slice(0);return b}if(a instanceof Object){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=PWG.Utils.clone(a[c]));return b}throw new Error("Unable to copy original! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.contains=function(a,b){var c=!1;if(Array.isArray(a))a.indexOf(b)>-1&&(c=!0);else for(var d in a)a.hasOwnProperty(d)&&a[d]===b&&(c=!0);return c},a.find=function(a,b){var c=null;if(Array.isArray(a)){for(var d=0,e=a.length;e>d;d++)if(a[d]===b){c=a[d];break}}else for(var f in a)if(a[f]===b){c=a[f];break}return c},a.arraysEqual=function(a,b){if(a===b)return!0;if(null==a||null==b)return!1;if(a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0},a.elementCount=function(a){if(counts={},!Array.isArray(a))return null;for(i=0,length=a.length;i<length;i++)counts[a[i]]||(counts[a[i]]=0),counts[a[i]]++;return counts},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.shuffle=function(a){for(var b,c,d=a.length;d;)c=Math.floor(Math.random()*d--),b=a[d],a[d]=a[c],a[c]=b;return a},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.coinToss=function(){return Math.random()<.5?!0:!1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a.onDomReady=function(){function a(){d?document.removeEventListener("DOMContentLoaded",a,!0):"complete"===document.readyState&&document.detachEvent("onreadystatechange",a),c()}function b(){if(!e){try{document.documentElement.doScroll("left")}catch(a){return void window.setTimeout(arguments.callee,15)}c()}}function c(){if(!e){e=!0;for(var a=g.length,b=0;a>b;b++)g[b].call(document)}}var d=!!document.addEventListener,e="complete"===document.readyState,f=!1,g=[];if(d)document.addEventListener("DOMContentLoaded",a,!0),window.addEventListener("load",c,!1);else{document.attachEvent("onreadystatechange",a),window.attachEvent("onload",c);try{f=null===window.frameElement}catch(h){}document.documentElement.doScroll&&f&&b()}return function(a){return e?a.call(document):g.push(a)}}(),a}(),PWG.DeviceUtils=function(){function a(){(document.webkitIsFullScreen||document.mozFullScreen||null!==document.msFullscreenElement)&&(i._isFullScreen=!1,h.length>0&&PWG.Utils.each(h,function(a){a.callback.call(a.context,a.params)},i))}var b=navigator.userAgent.toLowerCase(),c=window.document,d=c.documentElement,e=d.requestFullscreen||d.mozRequestFullScreen||d.webkitRequestFullScreen||d.msRequestFullscreen,f=c.exitFullscreen||c.mozCancelFullScreen||c.webkitExitFullscreen||c.msExitFullscreen,g=!1,h=[];document.addEventListener&&(document.addEventListener("webkitfullscreenchange",a,!1),document.addEventListener("mozfullscreenchange",a,!1),document.addEventListener("fullscreenchange",a,!1),document.addEventListener("MSFullscreenChange",a,!1));var i={};return i.browsers={IPHONE:"Iphone",ANDROID:"Android",CHROME:"Chrome",SAFARI:"Safari",FIREFOX:"Firefox",OPERA:"Opera",IE:"IE"},i.isMobile=function(){return b.match(/iphone|ipad|android/)},i.isIphone=function(){return b.match(/iphone/)},i.isAndroid=function(){return b.match(/android/)},i.isChrome=function(){return!!window.chrome&&!i.isOpera()},i.isSafari=function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0},i.isFirefox=function(){return"undefined"!=typeof InstallTrigger},i.isOpera=function(){return!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0},i.isIE=function(){return!1||!!document.documentMode},i.getType=function(a){var b="is"+a;return i[b]()},i.getBrowser=function(){var a="",b=i.browsers;for(var c in b)if(i.getType(b[c])){a=b[c];break}return a},i.getHasTransform=function(){var a;return function(a,b){b.transitions="transition"in a||"webkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a}(document.createElement("div").style,a||(a={})),a.transitions},i.toggleFullScreen=function(){c.fullscreenElement||c.mozFullScreenElement||c.webkitFullscreenElement||c.msFullscreenElement?i.exitFullScreen():i.enterFullScreen()},i.enterFullScreen=function(){i._isFullScreen||(i._isFullScreen=!0,e.call(d))},i.exitFullScreen=function(){i._isFullScreen&&(i._isFullScreen=!1,f.call(c))},i.getIsFullScreen=function(){return g},i.addFullScreenExitCallback=function(a,b,c){var d=b||window,e=c||{};h.push({callback:a,context:d,params:e})},i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}();var PWG=PWG||{};PWG.Timer=function(){function a(a){this.id=a,this.timeout=null,this.interval=null}var b={},c={},d=0;return a.prototype.start=function(a,b,c,d){var e=c||{},f=d||window,g=this;this.timeout=setTimeout(function(){b.call(f,g,e)},a)},a.prototype.loop=function(a,b,c,d){var e=c||{},f=d||window,g=this;this.interval=setInterval(function(){b.call(f,g,e)},a)},a.prototype.stop=function(){this.timeout?(clearTimeout(this.timeout),this.timeout=null):this.interval&&(clearInterval(this.interval),this.interval=null)},b.Controller=a,b.create=function(b){var e=b||d,f=new a(e);return c[e]=f,d++,f},b.get=function(a){return c.hasOwnProperty(a)?c[a]:void 0},b.stopAll=function(){PWG.Utils.each(c,function(a){a.stop()},b)},b.remove=function(a){c.hasOwnProperty(a)&&(c[a].stop(),delete c[a])},b}();var PWG=PWG||{};PWG.ViewportDimensions=function(){var a={initialized:!1,vw:-1,vh:-1};return a.init=function(){window.addEventListener("resize",a.onWindowResize),a.calculate(),a.initialized=!0},a.calculate=function(){var b=document.documentElement.clientWidth,c=document.documentElement.clientHeight;a.vw=b/100,a.vh=c/100},a.onWindowResize=function(){a.calculate()},a}(),PWG.ViewportDimensions.initialized||PWG.ViewportDimensions.init();var PWG=PWG||{};PWG.WindowParams=function(){var a={},b="";return a.width=-1,a.height=-1,a.orientation="",a.isOrientationChanged=!1,a.update=function(){return a.isOrientationChanged=!1,a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight,a.orientation=a.width>a.height?"landscape":"portrait",a.orientation!==b&&(a.isOrientationChanged=!0,b=a.orientation),{width:a.width,height:a.height,orientation:a.orientation,isOrientationChanged:a.isOrientationChanged}},a}();var PWG=PWG||{};PWG.StyleElManager=function(){var a={},b=document.getElementsByTagName("head")[0],c="",d={};return a.create=function(b){PWG.Utils.each(b,function(b,c){a.add(b,c)},a)},a.add=function(a,b){var c=document.createElement("style");c.setAttribute("id",b),c.appendChild(document.createTextNode(a)),d[b]=c},a.update=function(){if(PWG.WindowParams.isOrientationChanged){var a=PWG.WindowParams.orientation;""!==c&&d[c].parentNode.removeChild(d[c]),b.appendChild(d[a]),c=a}},a.replace=function(b,c){d.hasOwnProperty(c)&&(d[c].parentNode.removeChild(d[c]),delete d[c]),a.add(b,c)},a}();var PWG=PWG||{};PWG.TouchManager=function(){function a(a,b){this.el=a,this.currentTouches=[],this.listeners={},PWG.Utils.each(b,function(a,b){this.listeners[b]={},this.listeners[b].fn=a.fn,this.listeners[b].ctx=a.ctx||this,this.listeners[b].params=a.params||{}},this),this.addListeners()}function b(a){return{identifier:a.identifier,pageX:a.pageX,pageY:a.pageY}}function c(a,b){var c,d=b.currentTouches.length,e=-1;for(c=0;d>c;c++)if(b.currentTouches[c].identifier===a){e=c;break}return e}var d={};return a.prototype.addListeners=function(){PWG.DeviceUtils.isMobile()?(this.touchStartListener=function(a){return function(b){a.onTouchStart.call(a,b)}}(this),this.touchMoveListener=function(a){return function(b){a.onTouchMove.call(a,b)}}(this),this.touchEndListener=function(a){return function(b){a.onTouchEnd.call(a,b)}}(this),this.touchCancelListener=function(a){return function(b){a.onTouchCancel.call(a,b)}}(this),this.el.addEventListener("touchstart",this.touchStartListener,!1),this.el.addEventListener("touchmove",this.touchMoveListener,!1),this.el.addEventListener("touchend",this.touchEndListener,!1),this.el.addEventListener("touchleave",this.touchEndListener,!1),this.el.addEventListener("touchcancel",this.touchCancelListener,!1)):(this.mouseDownListener=function(a){return function(b){a.onMouseDown.call(a,b)}}(this),this.mouseMoveListener=function(a){return function(b){a.onMouseMove.call(a,b)}}(this),this.mouseUpListener=function(a){return function(b){a.onMouseUp.call(a,b)}}(this),this.el.addEventListener("mousedown",this.mouseDownListener,!1),this.el.addEventListener("mousemove",this.mouseMoveListener,!1),this.el.addEventListener("mouseup",this.mouseUpListener,!1))},a.prototype.removeListeners=function(){PWG.DeviceUtils.isMobile()?(this.el.removeEventListener("touchstart",this.touchStartListener,!1),this.el.removeEventListener("touchmove",this.touchMoveListener,!1),this.el.removeEventListener("touchend",this.touchEndListener,!1),this.el.removeEventListener("touchleave",this.touchEndListener,!1),this.el.removeEventListener("touchcancel",this.touchCancelListener,!1)):(this.el.removeEventListener("mousedown",this.mouseDownListener,!1),this.el.removeEventListener("mousemove",this.mouseMoveListener,!1),this.el.removeEventListener("mouseup",this.mouseUpListener,!1))},a.prototype.onTouchStart=function(a){a.preventDefault();var c,d=a.changedTouches,e=d.length;for(c=0;e>c;c++)this.currentTouches.push(b(d[c])),this.onStart(d[c])},a.prototype.onTouchMove=function(a){a.preventDefault();var d,e=a.changedTouches,f=e.length;for(d=0;f>d;d++){var g=c(e[d].identifier,this);g>-1&&(this.onMove(e[d]),this.currentTouches.splice(g,1,b(e[d])))}},a.prototype.onTouchEnd=function(a){a.preventDefault();var b,d=a.changedTouches,e=d.length;for(b=0;e>b;b++){var f=c(d[b].identifier,this);f>-1&&(this.onEnd(d[b]),this.currentTouches.splice(f,1))}},a.prototype.onTouchCancel=function(a){a.preventDefault();var b,d=a.changedTouches,e=d.length;for(b=0;e>b;b++){var f=c(d[b].identifier,this);f>-1&&(this.onCancel(d[b]),this.currentTouches.splice(b,1))}},a.prototype.onMouseDown=function(a){a.preventDefault(),this.mouseDown=!0,this.onStart(a)},a.prototype.onMouseMove=function(a){a.preventDefault(),this.mouseDown&&this.onMove(a)},a.prototype.onMouseUp=function(a){a.preventDefault(),this.mouseDown=!1,this.onEnd(a)},a.prototype.onStart=function(a){if(this.listeners.hasOwnProperty("start")){var b=this.listeners.start;b.fn.call(b.ctx,a,this.el,this,b.params)}},a.prototype.onMove=function(a){if(this.listeners.hasOwnProperty("move")){var b=this.listeners.move;b.fn.call(b.ctx,a,this.el,this,b.params)}},a.prototype.onEnd=function(a){if(this.listeners.hasOwnProperty("end")){var b=this.listeners.end;b.fn.call(b.ctx,a,this.el,this,b.params)}},a.prototype.onCancel=function(a){if(this.listeners.hasOwnProperty("cancel")){var b=this.listeners.cancel;b.fn.call(b.ctx,a,this.el,this,b.params)}},a.prototype.removeCurrentTouches=function(){PWG.Utils.each(this.currentTouches,function(){this.currentTouches.pop()},this)},a.prototype.destroy=function(){this.removeListeners(),this.removeCurrentTouches()},d.TouchController=a,d.touchControllers={},d.add=function(b,c,e){var f=e||b.id,g=new a(b,c);return d.touchControllers[f]=g,g},d.remove=function(a){d.touchControllers.hasOwnProperty(a)&&(d.touchControllers[a].destroy(),delete d.touchControllers[a])},d}(),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)}),window.requestAnimFrame=window.requestAnimationFrame}();var PWG=PWG||{};PWG.Animator=function(){function a(a,b,c,d,e,f,g){this.id=a,this.el=b,this.props=c,PWG.Utils.each(c,function(a){a.begin=parseInt(a.begin),a.end=parseInt(a.end),a.difference=a.end>a.begin?a.end-a.begin:-(a.begin-a.end),a.newValue=a.begin},this),this.duration=d,this.callback=e,this.context=f||window,this.params=g||{},this.completed=!1}var b={},c={},d=0;return a.prototype.start=function(){this.startTime=Date.now(),requestAnimationFrame(this.update.bind(this))},a.prototype.update=function(){var a,b=Date.now(),c="",d=b-this.startTime;d>this.duration&&(d=this.duration),a=d/this.duration,PWG.Utils.each(this.props,function(b){b.newValue=b.begin+a*b.difference,"rotate"===b.key?(c+="-webkit-transform:rotate("+b.newValue+"deg); ",c+="-ms-transform:rotate("+b.newValue+"deg); ",c+="transform:rotate("+b.newValue+"deg); "):c+=b.key+":"+b.newValue+b.unit+"; "},this),this.params&&this.params.styleString&&(c+=this.params.styleString),this.el.setAttribute("style",c),d>=this.duration&&(this.completed=!0),this.completed?this.onCompleted():requestAnimationFrame(this.update.bind(this))},a.prototype.stop=function(){this.completed=!0},a.prototype.onCompleted=function(){PWG.Utils.each(this.props,function(){},this),this.callback&&this.callback.call(this.context,this.id,this.el,this.params),PWG.Animator.kill(this.id)},b.Controller=a,b.create=function(b,e,f,g,h,i,j,k){var l="animation_"+(k||d),m=new a(l,b,e,f,h,i,j);return g&&m.start(),c[l]=m,d++,m},b.get=function(a){return c.hasOwnProperty(a)?c[a]:void 0},b.stopAll=function(){PWG.Utils.each(c,function(a){a.stop()},b)},b.kill=function(a){c.hasOwnProperty(a)&&(c[a].completed||c[a].stop(),c[a]=null,delete c[a])},b}();var PWG=PWG||{};PWG.AudioManager=function(){function a(a){trace("AudioManager.Sound, elId = "+a),this.soundEl=document.getElementById(a)}var b={},c={};return a.prototype.play=function(){trace("AudioManager.Sound/play, soundEl = ",this.soundEl),this.soundEl&&this.soundEl.play()},a.prototype.pause=function(){this.soundEl&&this.soundEl.pause()},a.prototype.load=function(a){this.soundEl&&(this.soundEl.src=a,this.soundEl.load())},b.Sound=a,b.createEl=function(a){var c=document.createElement("audio");c.setAttribute("id",a.id),PWG.Utils.each(a.sources,function(a){trace("adding source: ",a);var d=document.createElement("source");PWG.Utils.each(a,function(a,b){trace("	adding attr["+b+"]: ",a),d.setAttribute(b,a)},b),c.appendChild(d)},b),a.styles&&PWG.Utils.each(a.styles,function(a,b){c.style[b]=a},b);var d=a.parentId?document.getElementById(a.parentId):document.getElementsByTagName("body")[0];d.appendChild(c),a.el=a.id,b.addEl(a)},b.addEl=function(b){var d=new a(b.el);if(c[b.id]=d,trace("AudioManager/addEl, config = ",b),b.cb){var e=b.ctx||window;b.cb.call(e)}},b.play=function(a){c.hasOwnProperty(a)&&c[a].play()},b.pause=function(a){c.hasOwnProperty(a)&&c[a].pause()},b.load=function(a,b){c.hasOwnProperty(a)&&c[a].load(b)},b}();var PWG=PWG||{};PWG.User=function(){"use strict";function a(){var a={};a[b.localStorageKey]=c,PWG.Storage.set(a)}var b={};b.localStorageKey="pwgUser";var c={isFirstPlay:!0,needsGameOverMessage:!0,needsPlayerStatMessage:!0,players:{},tournaments:{}};return b.init=function(a,d){b.localStorageKey=d||b.localStorageKey;var e=PWG.Storage.get(b.localStorageKey);"undefined"!=typeof e&&(c=PWG.Utils.extend(c,e)),a&&a.call(b,c)},b.get=function(a){return c[a]},b.getData=function(){return c},b.set=function(b,d){"players"===b&&c.players?c.players=PWG.Utils.extend(c.players,d):c[b]=d,a()},b}();var PWG=PWG||{};PWG.GameEvents={GAME_STARTED:"gameStarted",LEVEL_STARTED:"levelStarted",LEVEL_FAILED:"levelFailed",LEVEL_COMPLETED:"levelCompleted",TURN_STARTED:"turnStarted",TURN_COMPLETED:"turnCompleted",GAME_OVER:"gameOver",GAME_COMPLETED:"gameCompleted",AD_STARTED:"adStarted",AD_COMPLETED:"adCompleted"};var PWG=PWG||{};PWG.TGSAdapter=function(){"use strict";function a(){PWG.Utils.each(n.divIds,function(a,b){var c=n.divIds[b]?n.divIds[b]:a;m[b]=document.getElementById(c)},f)}function b(){PWG.Utils.each(config.events,function(a,b){f.events[b]=PWG.Utils.extend(f.events[b],a)},f)}function c(){if(n.callback instanceof Function){var a=n.callback,b=f;n.callback={fn:a,ctx:b}}else n.callback.ctx=n.callback.ctx||f}function d(){e({type:PWG.GameEvents.AD_COMPLETED})}function e(a){if(n.callback){var b=n.callback;b.fn.call(b.ctx,a)}else PWG.EventCenter&&PWG.EventCenter.trigger({type:a})}var f={},g=1,h=1,i=[],j=!1,k=!1,l={GAME_ID:"farklesafari",ADS:{INTERSTITIAL_INTERVAL:300}},m={parentDiv:null,blurDiv:null,endScreenDiv:null,closeCallback:function(){d()}},n={};return f.events={game:{LOAD:"load",BEGIN:"begin",PAUSE:"pause",RESUME:"resume",END:"end"},log:{GAME_EVENT:"logGameEvent",LEVEL_EVENT:"logLevelEvent",CUSTOM_EVENT:"logCustomEvent",SHARE_EVENT:"logShareEvent",SCREEN:"logScreen",ACHIEVEMENT_EVENT:"logAchievementEvent"},level:{START:"start",COMPLETE:"complete",FAIL:"fail",REPLAY:"replay"},achievement:{NEW_HIGH_SCORE:"newHighScore",GAME_COMPLETED:"gameCompleted"}},f.init=function(d){if(n=d,a(),d.gameId&&(l.GAME_ID=d.gameId),d.events&&b(),d.levelCount)for(var e=0;e<d.levelCount;e++)i[e]=g;d.callback&&c(),"undefined"!=typeof TGS&&(j=!0)},f.logEvent=function(a,b){j&&TGS.Analytics[a].apply(f,b)},f.submitScore=function(a){j&&(a.leaderboardID=h,TGS.Leaderboard.SubmitScore(a))},f.turnStarted=function(){f.adCheck()},f.adCheck=function(){k?(f.displayInterstitial(),k=!1):(k=!0,d())},f.displayInterstitial=function(){e({type:PWG.GameEvents.AD_STARTED}),"undefined"!=typeof TGS&&TGS.Advertisement.DisplayInterstitialAd(m)},f.addWidget=function(){if(j){{PWG.Stage.winW,PWG.Stage.winH,PWG.Stage.unit}f.isOpen=!0}},f.removeWidget=function(){f.widget&&f.widget.close(),f.isClosed=!0},f.hideGameOverWidget=function(){f.widget&&f.widget.close(),m.endScreenDiv.style.display="none"},f}();var PWG=PWG||{};PWG.AdManager=function(a){function b(a,b,c,e){this.idx=a,this.type=b,this.system=PWG[d[b]],this.appCallback=e||function(){},c.callback={fn:this.callback,ctx:this},this.system.init(c)}var c=[],d={TRE_SENSA:"TGSAdapter"};return b.prototype.callback=function(a){this[a.type]instanceof Function&&(this[a.type].call(this,a),this.appCallback({type:PWG.GameEvents.AD_STARTED}))},b.prototype.turnStarted=function(a){a.userTurn&&this.system.turnStarted(a)},b.prototype.turnCompleted=function(){},b.prototype.levelStarted=function(){},b.prototype.levelCompleted=function(){},b.prototype.updateData=function(){},b.prototype.gameOver=function(){},a.create=function(a,e,f){if(d.hasOwnProperty(a)){var g;return g=new b(c.length,a,e,f),g&&c.push(g),g}},a.Systems=d,a}(PWG.AdManager||{});var PWG=PWG||{};PWG.FarkleSounds=function(){"use strict";var a={};return a.init=function(){},a.diceRoll=function(){},a}();var PWG=PWG||{};PWG.Tutorial=function(){"use strict";function a(){this.displayFirstRollTutorial=!0,this.displayFirstBankTutorial=!0,this.displayFirstSelectedTutorial=!0,this.displayFirstMinimumTutorial=!0,this.displayFirstFarkleTutorial=!0,this.displayFirstHotDiceTutorial=!0,this.displayFirstAITurn=!0,this.displayFreestyleRolls=!0,this.displayPlayRealGame=!0,this.isPresetRollsActive=!0,this.currentPresetRoll=0,this.currentPresetRollText=0;var b="The 5 die is the lowest scoring die. "+(PWG.App.isAndroid?"Drag it":"Click it to go")+" to the gray area at the bottom (bank.) Then, click the check button to score it for 50 points";a.ROLL_TEXTS.shift(b)}return a.FIRST_TIME_PLAYER="First time playing? Try the tutorial to learn the rules of the game.",a.PRE_GAME="Let's play farkle! <br />The object of the game is to be the first to gain 10,000 points.",a.GAME_START="We'll go through some practice turns first.<br />Press roll to start.",a.FIRST_BANK='Press down to bank selected dice.<br />Dice go into your "bank" or collection of scoring dice for the turn. Note: a minimum of 300 points is needed to end a turn.',a.FIRST_SELECTION="Your turn score has been updated. Your total score will not be affected until the turn is completed.<br />Roll again.",a.FIRST_MINIMUM="The minimum turn score has been met. You can roll again for the chance of a higher score or press > to end the turn. For now, let's see what one more roll will bring.",a.FIRST_FARKLE="You farkled! Be careful: 3 consecutive farkles in a row will deduct 500 points.",a.FIRST_HOT_DICE="You got hotdice! All dice are scorable.<br />The turn can continue with 6 new dice, but rolling is optional. Let's give it a try...",a.FIRST_AI_TURN="My turn...",a.PLAY_REAL_GAME="You seem to have the hang of it. Press next to complete tutorial.",a.TUTORIAL_COMPLETE="Note: only one die needs to be banked after each roll. Sometimes it's better to leave scoring dice in play -- the next roll might have better scores.<br />Press > to complete the tutorial and start a real game!",a.ROLLS=[[5,2,4,6,3,2],[5,1,3,3,4,2],[5,1,2,4,4,4],[5,1,1,4,4,4],[2,4,6,3,3,4],[3,3,4,4,6,6],[1,2,3,4,5,6]],a.ROLL_TEXTS=["This roll has one scorable die as well. A single 1 is worth 100 points. Drag and bank it.","This roll is a three-of-a-kind, worth 400 points. When you roll a triple, it is worth 100x the die. Four-of-a-kind = 200x, five-of-a-kind = 300x, etc.<br />Three 1's = 1000 points.","This last die is scorable since it is a 1. Drag and bank it to see what happens.",'Oh no! It\'s a "farkle." There are no scoring dice. When a farkle is rolled, the turn ends and 0 points are scored. Three in-a-row deducts 500 points from your total score.<br />Click > to continue.',"This roll is 3 pairs or \"full house\". It is worth 750 points. The only time pairs score is when there are 3 of them. In this case, it is 3's, 4's, and 6's, but it can be any combination.",'The final roll is a "straight" 1, 2, 3, 4, 5, 6. It\'s worth 1500 points. They are a rare, but lucky roll.'],a.prototype.getPresetRoll=function(){var b=null;return this.currentPresetRoll<a.ROLLS.length&&(b=a.ROLLS[this.currentPresetRoll],this.currentPresetRoll++),b},a.prototype.getPresetRollText=function(){var b="";return this.currentPresetRollText<a.ROLLS.length&&(b=a.ROLL_TEXTS[this.currentPresetRollText],this.currentPresetRollText++),this.currentPresetRoll>=a.ROLLS.length&&(this.isPresetRollsActive=!1),b},a}();var PWG=PWG||{};PWG.Farkle=function(){"use strict";function a(a){this.idx=a,this.value=-1,this.groupId="",this.isScorable=!1,this.isActive=!0,this.isSelected=!1}function b(a){this.availableDice=a,this.collection=[],this.throwScores=[],this.totalScore=0,this.usedDice=0;for(var b=0;a>b;b++)this.collection.push(new c.Die(b))}var c={};return c.NUM_DICE=6,c.MIN_TURN_SCORE=300,c.STRAIGHT_SCORE=1500,c.FULL_HOUSE_SCORE=750,c.ONE_TRIPLE_MULTIPLIER=1e3,c.TRIPLE_MULTIPLIER=100,c.FIVE_SCORE=50,c.ONE_SCORE=100,c.TRIPLE_FARKLE=500,c.NUM_FARKLES_BEFORE_DEDUCTION=3,c.WINNING_SCORE=1e4,a.prototype.roll=function(){this.value=PWG.Utils.diceRoll()},a.prototype.setActive=function(a){this.isActive=a,this.groupId=""},b.prototype.roll=function(){PWG.Utils.each(this.collection,function(a){a.isActive&&a.roll()},this)},b.prototype.getActive=function(){var a=[];return PWG.Utils.each(this.collection,function(b){b.isActive&&a.push(b)},this),a},b.prototype.getActiveValues=function(){var a=[];return PWG.Utils.each(this.collection,function(b){b.isActive&&a.push(b.value)},this),a},b.prototype.setAllActive=function(){PWG.Utils.each(this.collection,function(a){a.setActive(!0)},this)},b.prototype.resetGroupIds=function(){PWG.Utils.each(this.collection,function(a){a.groupId=""},this)},b.prototype.parseCurrentRoll=function(){var a=this.getActive();if(this.setAllScorable(!1),this.groups=[],this.hotDice=!1,this.farkled=!0,this.scoringDice=0,c.straightTest(this.getActiveValues()))this.hotDice=!0,this.farkled=!1,this.scoringDice=6,this.setAllScorable(!0,"straight"),this.groups.push("straight");else{var b={1:[],2:[],3:[],4:[],5:[],6:[]};PWG.Utils.each(a,function(a){b[a.value].push(a)},this);var d=0,e=0;PWG.Utils.each(b,function(a,b){a.length>=3?(this.farkled=!1,this.groups.push("triple"+b),e++,PWG.Utils.each(a,function(a){this.scoringDice++,a.isScorable=!0,1!==parseInt(b)&&5!==parseInt(b)&&(a.groupId="triple"+b)},this)):2==a.length&&d++},this),3===d?(this.setAllScorable(!0,"fullHouse"),this.groups.push("fullHouse"),this.farkled=!1,this.hotDice=!0,this.scoringDice=6):2===e&&(this.hotDice=!0),b[1].length>0&&b[1].length<3&&(this.farkled=!1,this.parseOnesAndFives(b,1)),b[5].length>0&&b[5].length<3&&(this.farkled=!1,this.parseOnesAndFives(b,5)),6===this.scoringDice&&(this.hotDice=!0)}},b.prototype.parseOnesAndFives=function(a,b){PWG.Utils.each(a[b],function(a){a.isScorable=!0,this.scoringDice++},this)},b.prototype.setAllScorable=function(a,b){this.hotDice=!0,PWG.Utils.each(this.collection,function(c){c.isScorable=a,b&&(c.groupId=b)},this)},b.prototype.bankScoringDice=function(a){var b=0,d={},e=0,f=0;for(var g in a){var h=this.collection[a[g]];if(""!==h.groupId){if("straight"===h.groupId){b+=c.STRAIGHT_SCORE,this.setAllActive(!1),this.usedDice+=6;break}if("fullHouse"===h.groupId){b+=c.FULL_HOUSE_SCORE,this.setAllActive(!1),this.usedDice+=6;break}d[h.value]||(d[h.value]=0),d[h.value]++,h.setActive(!1),this.availableDice--,this.usedDice++}else 1===h.value?(e++,h.setActive(!1),this.availableDice--,this.usedDice++):5===h.value&&(f++,h.setActive(!1),this.availableDice--,this.usedDice++)}PWG.Utils.each(d,function(a,d){b+=(a-2)*d*c.TRIPLE_MULTIPLIER},this),e>0&&(b+=e>=3?(e-2)*c.ONE_TRIPLE_MULTIPLIER:e*c.ONE_SCORE),f>0&&(b+=f>=3?5*(f-2)*c.TRIPLE_MULTIPLIER:f*c.FIVE_SCORE),this.totalScore+=b,this.throwScores.push(b),this.resetGroupIds(),this.hotDice=this.usedDice%6===0?!0:!1,0===this.availableDice&&(this.availableDice=c.NUM_DICE,this.setAllActive(!0))},b.prototype.destroy=function(){PWG.Utils.each(this.collection,function(a,b){delete this.collection[b]},this),this.collection=null},c.Die=a,c.TurnDice=b,c.straight=[1,2,3,4,5,6],c.games={},c.initGame=function(a,b){c.games[a]={},c.games[a].callback=b},c.getTurnDice=function(a){return c.games[a]?c.games[a].turnDice:void 0},c.startTurn=function(a){c.games[a].turnDice=new c.TurnDice(c.NUM_DICE)},c.roll=function(a){return c.games[a].turnDice.roll(),c.games[a].turnDice.parseCurrentRoll(),c.games[a].turnDice},c.rollStraight=function(a){return c.games[a].turnDice.collection[0].value=1,c.games[a].turnDice.collection[1].value=2,c.games[a].turnDice.collection[2].value=3,c.games[a].turnDice.collection[3].value=4,c.games[a].turnDice.collection[4].value=5,c.games[a].turnDice.collection[5].value=6,c.games[a].turnDice.parseCurrentRoll(),c.games[a].turnDice},c.rollFullHouse=function(a){return c.games[a].turnDice.collection[0].value=2,c.games[a].turnDice.collection[1].value=2,c.games[a].turnDice.collection[2].value=3,c.games[a].turnDice.collection[3].value=3,c.games[a].turnDice.collection[4].value=6,c.games[a].turnDice.collection[5].value=6,c.games[a].turnDice.parseCurrentRoll(),c.games[a].turnDice},c.rollDoubleTrips=function(a){return c.games[a].turnDice.collection[0].value=2,c.games[a].turnDice.collection[1].value=2,c.games[a].turnDice.collection[2].value=2,c.games[a].turnDice.collection[3].value=6,c.games[a].turnDice.collection[4].value=6,c.games[a].turnDice.collection[5].value=6,c.games[a].turnDice.parseCurrentRoll(),c.games[a].turnDice},c.rollFarkle=function(a){return c.games[a].turnDice.collection[0].value=2,c.games[a].turnDice.collection[1].value=2,c.games[a].turnDice.collection[2].value=3,c.games[a].turnDice.collection[3].value=3,c.games[a].turnDice.collection[4].value=4,c.games[a].turnDice.collection[5].value=6,c.games[a].turnDice.parseCurrentRoll(),c.games[a].turnDice},c.rollValues=function(a,b){return PWG.Utils.each(b,function(b,d){c.games[a].turnDice.collection[d].value=b},c),c.games[a].turnDice.parseCurrentRoll(),c.games[a].turnDice},c.bankScoringDice=function(a,b){return c.games[a].turnDice.bankScoringDice(b),c.games[a].turnDice.throwScores},c.straightTest=function(a){var b=!1,c=a.length;if(6===c){var d=PWG.Utils.elementCount(a);1===d[1]&&1===d[2]&&1===d[3]&&1===d[4]&&1===d[5]&&1===d[6]&&(b=!0)}return b},c.getGroupScore=function(a,b){var d=0;if("straight"===a)d=c.STRAIGHT_SCORE;else if("fullHouse"===a)d=c.FULL_HOUSE_SCORE;else if(a.indexOf("triple")>-1){var e=parseInt(a.substr("triple".length,a.length));d=(b-2)*e*c.TRIPLE_MULTIPLIER}return d},c.getOnesScore=function(a){var b=0;return b=a>=3?(a-2)*c.ONE_TRIPLE_MULTIPLIER:a*c.ONE_SCORE},c.getFivesScore=function(a){var b=0;return b=a>=3?5*(a-2)*c.TRIPLE_MULTIPLIER:a*c.FIVE_SCORE},c.quitGame=function(a){c.games[a].turnDice&&(c.games[a].turnDice.destroy(),c.games[a].turnDice=null,delete c.games[a])},c}();var PWG=PWG||{};PWG.Player=function(){"use strict";function a(b){var c=PWG.Utils.extend(PWG.Utils.clone(a.config),b);PWG.Utils.extend(this,c),this.isAIPlayer=b.isAIPlayer||!1,this.isTournamentGame=b.isTournamentGame||!1,this.score=0,this.turns=0,this.currentFarkles=0,this.currentHotDice=0,this.isPaused=!1}return a.detailText={intTounamentGames:"tournament games: ",intTounamentsWon:"tournament wins: ",intGames:"games:",intWins:"wins: ",intFastestWin:"fastest win: ",intHighestTurnScore:"highest turn score: ",intTotalHotDice:"total hot dice: ",intTotalFarkles:"total farkles: "},a.config={name:"",intTounamentGames:0,intTounamentsWon:0,intGames:0,intWins:0,intFastestWin:0,intHighestTurnScore:0,intTotalHotDice:0,intTotalFarkles:0},a.prototype.pause=function(){this.isPaused=!0
},a.prototype.resume=function(){this.isPaused=!1},a.prototype.reset=function(){this.score=0,this.currentFarkles=0,this.turns=0,this.isPaused=!1},a.prototype.onTurnEnded=function(a,b){a?this.currentFarkles>=PWG.Farkle.NUM_FARKLES_BEFORE_DEDUCTION&&(this.score-=PWG.Farkle.TRIPLE_FARKLE,this.currentFarkles=0):(this.currentFarkles=0,this.score+=b.totalScore,this.checkHighestTurnScore(b.totalScore))},a.prototype.checkHighestTurnScore=function(a){a>this.intHighestTurnScore&&(this.intHighestTurnScore=a)},a.prototype.hasHotDice=function(a){a?(this.intTotalHotDice++,this.currentHotDice++,this.currentHotDice>this.intConsecutiveHotDice&&(this.intConsecutiveHotDice=this.currentHotDice)):this.currentHotDice=0},a.prototype.hasFarkled=function(){this.currentFarkles++,this.intTotalFarkles++},a.prototype.hasFinishedGame=function(){this.intGames++,this.isTournamentGame&&this.intTounamentGames++},a.prototype.hasWon=function(){this.intWins++,(0===this.intFastestWin||this.turns<this.intFastestWin)&&(this.intFastestWin=this.turns)},a.prototype.hasWonTournament=function(){this.intTounamentsWon++},a.prototype.getStats=function(){var a={name:this.name,intTounamentGames:this.intTounamentGames,intTounamentsWon:this.intTounamentsWon,intGames:this.intGames,intWins:this.intWins,intFastestWin:this.intFastestWin,intHighestTurnScore:this.intHighestTurnScore,intTotalHotDice:this.intTotalHotDice,intTotalFarkles:this.intTotalFarkles};return a},a}();var PWG=PWG||{};PWG.Personalities=function(){"use strict";function a(a,d){PWG.Utils.each(a,function(a,e){var f=c[d][e];PWG.Utils.each(f,function(b){a.push(b)},b)},b)}var b={},c={game:{start:["Let's begin.","Game on!"]},dealer:{startTurn:["My turn.","I'm up.","Dice are to me."],positive:["Yay!","Excellent"],negative:["Boo!","No."],leading:["You're falling behind."],won:["I'm the winner!","I win."]},player:{startTurn:["Your turn","You're up","Dice are to you"],positive:["Good for you.","Well done."],negative:["That's too bad.","Ouch."],leading:["I'm falling behind."],won:["You're the winner!","You win"]}};return b.animals={bear:{game:{start:["Come to my den for a game."]},dealer:{startTurn:["THIS is going to be the one."],positive:["Smooth, like honey!"],negative:["*GROWL*"],leading:["I can chase you up a hill!"],won:["Time to hibernate."]},player:{startTurn:["You give it a try."],positive:["Berry good!"],leading:["I should have gone fishing."],negative:["You should have gone fishing."],won:["Time to hibernate."]}},wolf:{game:{start:["*HOWL*","The moon is down."]},dealer:{startTurn:["Put the dice in my paw."],positive:["*HOWL*"],negative:["*HOWL*"],leading:["I love a full moon."],won:["Winter is coming."]},player:{startTurn:["Take the dice."],positive:["*HOWL*"],leading:["You should join our pack!"],negative:["That's rough."],won:["You should join our pack!"]}},fox:{game:{start:["Time to get out of my hole."]},dealer:{startTurn:["Nothing up my sleeve..."],positive:["The fox knows many tricks."],negative:["I hate it when that happens."],leading:["There's no stopping me!"],won:["You can only catch the fox with cunning."]},player:{startTurn:["One must be a fox to recognize traps."],positive:["You're cunning is impressive!"],leading:["You're cunning is impressive!"],negative:["Many foxes grow gray, but few grow good."],won:["With foxes, you must play the fox."]}},lynx:{game:{start:["I challenge you to a game of dice!"]},dealer:{startTurn:["And now I shall prevail!"],positive:["Fortune shines upon me!"],negative:["Oh! The fates are wicked."],leading:["I shall leave you to weep."],won:["Your time of reconing is here."]},player:{startTurn:["Now is your chance to succeed"],positive:["Well played!"],leading:["You're crushing it!"],negative:["Fortune has left you."],won:["My time of reconing is here."]}},beaver:{game:{start:["What is that hat you're wearing?"]},dealer:{startTurn:["I'm a believer."],positive:["DAM!"],negative:["DAM!"],leading:["This is going swimmingly for me."],won:["I've got beaver fever!"]},player:{startTurn:["Gopher it!"],positive:["Kangaroo RATS!"],leading:["I should have stayed in the lodge"],negative:["DAM!"],won:["Stay away from my dam."]}},deer:{game:{start:["Doe you wanna play a game?"]},dealer:{startTurn:["The dog that is forced into the woods will not hunt many deer."],positive:["That's a 12-pointer!"],negative:["Bambi will not be happy."],leading:["Lions in time of peace; deer in war."],won:["Lions in time of peace; deer in war."]},player:{startTurn:["Serve as a serf or fly like a deer!"],positive:["A monkey that amuses me is better than a deer astray."],leading:["Bambi is going to cry."],negative:["If you are hunting for a red deer then ignore the hares."],won:["Deer-hunter, waste not your arrow on the hare."]}},hawk:{game:{start:["Are you ready for some dice?"]},dealer:{startTurn:["Nothing up my sleeve...","Sometimes you gotta roll the hard six."],positive:["I'm on a roll!"],negative:["I hate it when that happens.","RATS!"],leading:["There's no stopping me!"],won:["I win!"]},player:{startTurn:["You're up.","Your time to shine!"],positive:["You're on a roll!"],leading:["You're crushing it!"],negative:["Sorry about you're luck."],won:["You are a superb opponent!","You win!"]}},squirrel:{endGame:"Click the farkle title to end a game.",playerStats:"Click player names to see their stats.",game:{start:["Are you ready for some dice?"]},dealer:{startTurn:["Nothing up my sleeve...","Sometimes you gotta roll the hard six."],positive:["I'm on a roll!"],negative:["I hate it when that happens.","NUTS!"],leading:["There's no stopping me!"],won:["I win!"]},player:{startTurn:["You're up.","Your time to shine!"],positive:["You're on a roll!"],leading:["You're crushing it!"],negative:["Sorry about you're luck."],won:["You are a superb opponent!","You win!"]}},shark:{game:{start:["Let's play a game."]},dealer:{startTurn:["I'm gonna make it right."],positive:["I can taste it in the water tonight!"],negative:["I'm throwin' it all away."],leading:["You're in too deep!"],won:["I won, against all odds!"]},player:{startTurn:["You oughta know by now."],positive:["I just can't take it.","Don't you lose that number!"],leading:["I'm throwin' it all away."],negative:["You're throwin' it all away"],won:["There's something about you!"]}},whale:{game:{start:["I sing a song of dice."]},dealer:{startTurn:["C'mon hot dice!","I gotta good feeling about this one."],positive:["*sprays from blowhole*","*sings*","It's no fluke!"],negative:["*sigh*","Plankton!"],leading:["You better swim faster."],won:["*sings* I love this game!"]},player:{startTurn:["Dive deeper.","My cousin once ate a shark.","Work your flippers!"],positive:["*sprays from blowhole*","Plankton!"],leading:["*splashes* I need to catch up."],negative:["You better swim faster."],won:["*moans*"]}},squid:{game:{start:["Game on!"]},dealer:{startTurn:["C'mon hot dice!","I'm gonna drag you down to the depths."],positive:["I have 3 hearts and 3 times the luck!"],negative:["*sigh*"],leading:["You'd better swim to the surface soon."],won:["I love this game!"]},player:{startTurn:["Give it your best!","Roll 'em."],positive:["Amazing!"],leading:["I'm falling too far behind."],negative:["Better luck next time."],won:["You're pretty good at this."]}},barracuda:{game:{start:["Game on!"]},dealer:{startTurn:["Teeth like razors","I'm about to SCHOOL you."],positive:["OOO! Barracuda!"],negative:["MACKEREL!"],leading:["I could eat a dolphin!"],won:["Piranhas are overrated.","I could eat a dolphin!"]},player:{startTurn:["Give it your best!","Roll 'em."],positive:["MACKEREL!"],leading:["I'm falling too far behind."],negative:["Feel the bite.","Painful, isn't it?"],won:["I going back to hunting."]}},stingray:{game:{start:["I'm not ray of sunshine."]},dealer:{startTurn:["Don't tread on me.","I bit off Hercules's finger.","I lent Circe my stinger for a spear."],positive:["That's the STING","My poison hurts."],negative:["I'm going back to the floor","I gotta get my head outta the sand"],leading:["My poison hurts."],won:["You should've played Manta - he's a softy."]},player:{startTurn:["Don't tread on me.","Don't caught in undertow"],positive:["I've felt YOUR sting now."],leading:["I gotta get my head outta the sand"],negative:["Better luck next time."],won:["I'll just got back to the sand now."]}},crab:{game:{start:["*snaps claws*"]},dealer:{startTurn:["*snaps claws*"],positive:["*snaps claws*"],negative:["*snaps claws*"],leading:["*snaps claws*"],won:["*snaps claws*"]},player:{startTurn:["*snaps claws*"],positive:["*snaps claws*"],leading:["*snaps claws*"],negative:["*snaps claws*"],won:["*snaps claws*"]}},dolphin:{game:{start:["My name is Opo."]},dealer:{startTurn:["Fishing boats leave a great trail.","Don't call me Jack."],positive:["That's my favorite stunt!","I loved 'Opo the Friendly Dolphin'."],negative:["Fishermen can be mean."],leading:["Swim faster! Swim faster!"],won:["*flips*"]},player:{startTurn:["I love playing with children."],positive:["'tBottlenose' is insulting.","Koutu Point!"],leading:["I'm falling too far behind."],negative:["I never met Kupe."],won:["*flips*"]}},penguin:{endGame:"Click the farkle title to end a game.",playerStats:"Click player names to see their stats.",game:{start:["Game on!"]},dealer:{startTurn:["C'mon hot dice!","I gotta good feeling about this one."],positive:["That's nice!"],negative:["*sigh*"],leading:["You'd better step it up."],won:["I love this game!"]},player:{startTurn:["Give it your best!","Roll 'em."],positive:["Amazing!"],leading:["I'm falling too far behind."],negative:["Better luck next time."],won:["You're pretty good at this."]}},lion:{game:{start:["I am the king."]},dealer:{startTurn:["Watch and learn.","Hear me ROAR..."],positive:["WOO HOO!"],negative:["I hate it when that happens."],leading:["You have your work cut out for you!"],won:["*ROAR*"]},player:{startTurn:["Let's see what you got.","Throw with heart."],positive:["You're a natural."],leading:["You're stealing my pride."],negative:["..."],won:["You are a superb opponent!"]}},cobra:{game:{start:["Yo Joe?"]},dealer:{startTurn:["Citizens of the world...","I make all of the important decisions.","A sterling symbol of power."],positive:["Look and tremble!","I am the new fire department!"],negative:["Out in the rain...","Whose side are you on?","Poppycock!"],leading:["I have a power greater than any in history."],won:["Stop sputtering.","I must have control.","Oh, picky, picky, picky."]},player:{startTurn:["You've got them eating out of your hand.","You'll give them someone to look up to."],positive:["I lost my cubes!","I will not allow such impertinence.","Poppycock!"],leading:["My wonderful cubes!"],negative:["Look and tremble!","You lack imagination."],won:["I have morons on my payroll!","Now I'll never rule the world!","An assassination of my character!"]}},badger:{game:{start:["THIS is the honey badger."]},dealer:{startTurn:["Give me some snake eyes.","I'm crazy!","I'm hungry."],positive:["Loot out, Jackal, here I come!","I take what I want.","I do all of the work."],negative:["I don't give a rip.","I'm running backwards!"],leading:["My shoulders are broad!"],won:["I need a mouse to eat.","Cobra for two weeks.","I need to find some honey."]},player:{startTurn:["I eat snakes.","I love to dig.","Poison can't hurt me."],positive:["I'm fearless.","*grunts*","Sting me all you want!"],leading:["I will never stop chasing you!"],negative:["I have no regard for any animal.","I like bee larva for dinner."],won:["I need a mouse to eat.","I going to take a nap.","I need some honey to eat."]}},elk:{game:{start:["Are you ready, red deer?"]},dealer:{startTurn:["Watch and learn.","Don't touch my velvet."],positive:["This velvet has been good to me!","I have the loudest bugles!"],negative:["It's an infectious disease!","I need a vaccination."],leading:["You have your work cut out for you!"],won:["Only a moose can lose.","Conquering "]},player:{startTurn:["Stop posturing and role."],positive:["WAPITI!","*bugles*","I need a thicker coat."],leading:["*bugles*"],negative:["*bugles*","You need a thicker coat."],won:["Time to shed my antlers.","Gotta go find a cow."]}},vulture:{game:{start:["Let me tell you about my family..."]},dealer:{startTurn:["Cinereous","Griffon","White-rumped","Rüppell's","Indian","Slender-billed","Himalayan","White-backed","Cape","Hooded","Red-headed","Lappet-faced","White-headed","Lammergeier","Bearded","Egyptian","Palm-nut","Black","Turkey","Lesser yellow-head","Greater yellow-head","California condor","Andean condor"],positive:["Cinereous","Griffon","White-rumped","Rüppell's","Indian","Slender-billed","Himalayan","White-backed","Cape","Hooded","Red-headed","Lappet-faced","White-headed","Lammergeier","Bearded","Egyptian","Palm-nut","Black","Turkey","Lesser yellow-head","Greater yellow-head","California condor","Andean condor"],negative:["Cinereous","Griffon","White-rumped","Rüppell's","Indian","Slender-billed","Himalayan","White-backed","Cape","Hooded","Red-headed","Lappet-faced","White-headed","Lammergeier","Bearded","Egyptian","Palm-nut","Black","Turkey","Lesser yellow-head","Greater yellow-head","California condor","Andean condor"],leading:["Cinereous","Griffon","White-rumped","Rüppell's","Indian","Slender-billed","Himalayan","White-backed","Cape","Hooded","Red-headed","Lappet-faced","White-headed","Lammergeier","Bearded","Egyptian","Palm-nut","Black","Turkey","Lesser yellow-head","Greater yellow-head","California condor","Andean condor"],won:["And me, King Vulture."]},player:{startTurn:["Cinereous","Griffon","White-rumped","Rüppell's","Indian","Slender-billed","Himalayan","White-backed","Cape","Hooded","Red-headed","Lappet-faced","White-headed","Lammergeier","Bearded","Egyptian","Palm-nut","Black","Turkey","Lesser yellow-head","Greater yellow-head","California condor","Andean condor"],positive:["Cinereous","Griffon","White-rumped","Rüppell's","Indian","Slender-billed","Himalayan","White-backed","Cape","Hooded","Red-headed","Lappet-faced","White-headed","Lammergeier","Bearded","Egyptian","Palm-nut","Black","Turkey","Lesser yellow-head","Greater yellow-head","California condor","Andean condor"],leading:["Cinereous","Griffon","White-rumped","Rüppell's","Indian","Slender-billed","Himalayan","White-backed","Cape","Hooded","Red-headed","Lappet-faced","White-headed","Lammergeier","Bearded","Egyptian","Palm-nut","Black","Turkey","Lesser yellow-head","Greater yellow-head","California condor","Andean condor"],negative:["Cinereous","Griffon","White-rumped","Rüppell's","Indian","Slender-billed","Himalayan","White-backed","Cape","Hooded","Red-headed","Lappet-faced","White-headed","Lammergeier","Bearded","Egyptian","Palm-nut","Black","Turkey","Lesser yellow-head","Greater yellow-head","California condor","Andean condor"],won:["And me, King Vulture."]}},jackal:{game:{start:["Here we go!"]},dealer:{startTurn:["I am not the lonely type.","Hunting is my hobby."],positive:["It's a dog-eat-dog world!","I'm golden."],negative:["That's rough!","I prefer dusk to dawn."],leading:["I'm golden."],won:["Anubis helped.","I'm golden."]},player:{startTurn:["Throw with heart."],positive:["It's a dog-eat-dog world!","I'm not cowardly; you are!"],negative:["That's rough!"],leading:["I had a hunting partner once."],won:["Why do jackals get such a bad rap?","I never liked hunting in groups."]}},rhino:{game:{start:["Welcome to Earth!"]},dealer:{startTurn:["Sometimes, I spend whole nights looking to the stars.","I want to believe."],positive:["They've beamed me powers!","Did you see that?","Welcome Visitors!","Strange lights in the night!"],negative:["They're not telling us SOMETHING.","I'm stuck in a blackhole!"],leading:["I'm light years ahead of you!"],won:["The truth IS out there.","I am off to Proxima Centuri!"]},player:{startTurn:["I was abducted once.","No one believes me."],positive:["You're outta this world!","NOTHING can travel faster than light!"],negative:["..."],leading:["I'm two parsecs behind!"],won:["The truth IS out there.","Area 51 is calling me."]}},camel:{endGame:"Click the farkle title to end a game.",playerStats:"Click player names to see their stats.",game:{start:["Here we go!"]},dealer:{startTurn:["Watch and learn.","Dice don't fail me now!"],positive:["WOO HOO!"],negative:["I hate it when that happens."],leading:["You have your work cut out for you!"],won:["You'll have to try again..."]},player:{startTurn:["Let's see what you got.","Throw with heart."],positive:["You're a natural."],leading:["I gotta get ahead!"],negative:["..."],won:["You are a superb opponent!"]}},gorilla:{game:{start:["..."]},dealer:{startTurn:["*chuckles*"],positive:["*chuckles*","*HOOTS*"],negative:["*cries*","*ROARS*"],leading:["*HOOTS*"],won:["*HOOTS*"]},player:{startTurn:["*chuckles*"],positive:["*ROARS*"],negative:["*chuckles*"],leading:["*cries*"],won:["*cries*"]}},panther:{game:{start:["Up for a game of cat and mouse?"]},dealer:{startTurn:["Where's the nip?","You gotta ball of yarn?"],positive:["*PURR*","*raises tail*"],negative:["*hisses*","*growls*","*roars*","*flattens ears*"],leading:["You're HISStory!"],won:["You're HISStory!"]},player:{startTurn:["You can be my scratching post.","Got milk?"],negative:["*purrs*","*raises tail*"],positive:["*hisses*","*growls*","*roars*"],leading:["I'd better catch up!"],won:["Meow-t."]}},python:{game:{start:["Let'sss play!"]},dealer:{startTurn:["SSStarting my turn..."],positive:["YESSS!"],negative:["Unsssettling."],leading:["SSSomeone'sss not doing ssso well."],won:["SSSorry about your luck."]},player:{startTurn:["SSStart your turn!"],positive:["SSSuper."],leading:["SSSomeone'sss doing well."],negative:["SSSo sssad."],won:["Thisss makesss me sssad."]}},elephant:{game:{start:["The circus is in town!","I am the children's giant pet."]},dealer:{startTurn:["I am not a clown.","My balance is better than yours.","My brother is Dumbo.","My father was Jumbo."],positive:["I like picking up the lady with my trunk.","*TRUMPETS*"],negative:["PEANUTS!"],leading:["I've got a good lead going!"],won:["*TRUMPETS*"]},player:{startTurn:["Barnum was a good guy.","Bailey was mean.","The brothers are fools"],positive:["PEANUTS!"],negative:["I hate walking on that ball."],leading:["I'd better catch up!"],won:["*sits down*"]}},cockatoo:{game:{start:["Let's play!"]},dealer:{startTurn:["I just flew in from Miami Beach.","Have you ever been to Key West?"],positive:["Celebration!","Spring BREAK!"],negative:["Orlando has too many tourists for me."],leading:["I've got a good lead going!"],won:["Gators RULE!"]},player:{startTurn:["Jacksonville never offered me much","I prefer fishing on the Wassisa.","Wakula is nice too."],positive:["Swamp water!","WHERE did you say you were from?"],negative:["Celebration!","Spring BREAK!"],leading:["I'd better catch up!"],won:["Save the Manatee!"]}},crocodile:{game:{start:["*SNAPS*"]},dealer:{startTurn:["I overheat in the sun if my mouth isn't open.","I used to eat crustaceans.","I like eating bats now."],positive:["I still have 68 of my 72 teeth!","The eggs are hatching."],negative:["Oh snap!"],leading:["I've got a good lead going!"],won:["*SNAPS*"]},player:{startTurn:["My kids love insects.","I am 8 feet, 3 inches. You?"],positive:["I bet I weigh more than you."],negative:["I still have 68 of my 72 teeth!"],leading:["I'd better catch up!"],won:["*SNAPS*"]}},bat:{game:{start:["Step into my castle."]},dealer:{startTurn:["Vlad was overrated.","I never drink... wine.","I'm out of the coffin now."],positive:["Bring on the night!"],negative:["The sun is too much!","No more garlic!"],leading:["You have quite the CROSS to bare."],won:["You will never leave my castle now."]},player:{startTurn:["Your turn.","Bella did a fine portrayal.","This is a high STEAKS game."],positive:["I can not stand the sun!","Keep that garlic away from me!"],leading:["I'd better catch up!"],negative:["Bring on the night!"],won:["You may leave my castle now."]}},monkey:{endGame:"Click the farkle title to end a game.",playerStats:"Click player names to see their stats.",game:{start:["Let's play!"]},dealer:{startTurn:["My turn...","Here goes nothin'."],positive:["Yeah!"],negative:["Oh no!","I hate it when that happens."],leading:["I've got a good lead going!"],won:["You played well, but I was better.","Better luck next game.","Sweet victory!"]},player:{startTurn:["Good luck!","Your turn."],positive:["Nice one."],leading:["I'd better catch up!"],negative:["Womp womp.","Too bad."],won:["Great game!","I'll get you next time!","I can't believe I lost."]}}},b.init=function(){PWG.Utils.each(b.animals,function(b){a(b.game,"game"),a(b.dealer,"dealer"),a(b.player,"player")},b)},b.getPersonality=function(a){return PWG.Utils.has(b.animals,a)?b.animals[a]:c},b}();var PWG=PWG||{};PWG.AIPersonality=function(){"use strict";function a(a,b){this.name=a,this.isTournamentGame=b,this.opponentName="",this.isFirstComment=!0,this.isWinning=!1,this.isLosing=!1,this.endGameDisplayed=!1,this.playerStatsDisplayed=!1,this.closeTimer=null,this.personality=PWG.Personalities.getPersonality(a)}function b(a,b,d){e.closeCallback&&c(1);var f=PWG.Utils.diceRoll(e.activeComments[b][d].length)-1,g=e.activeComments[b][d].splice(f,1);return e.previousComment[b][d]>-1&&e.activeComments[b][d].push(a[b][d][e.previousComment[b][d]]),e.previousComment[b][d]=f,g}function c(a){e.closeTimer&&(e.closeTimer.stop(),PWG.Timer.remove(e.closeTimer.id)),e.closeTimer=PWG.Timer.create(),e.closeTimer.start(PWG.App.DELAY_TIME*a,function(a,b){b.cb.call(b.ctx),PWG.Timer.remove(a.id)},{cb:d,ctx:e},e)}function d(){e.closeTimer=null,e.closeCallback&&e.closeCallback.call(e.closeCallbackContext)}var e={},f=2e3;return a.prototype.getTurnStartComment=function(a,d){var d=PWG.Players.getIsAITurn(a);if(e.closeTimer&&e.closeTimer.stop(),""===this.opponentName){var g=PWG.Players.getAll(a);PWG.Utils.each(g,function(a){a.isAIPlayer||(this.opponentName=a.name)},this)}var h="";if(this.isFirstComment)h=b(this.personality,"game","start"),this.isFirstComment=!1;else{var i=PWG.Players.getScores();d?PWG.App.getData("needsGameOverMessage")&&!this.isTournamentGame?(h=this.personality.endGame,PWG.App.saveData("needsGameOverMessage",!1),e.closeCallback&&c(2)):PWG.App.getData("needsPlayerStatMessage")&&!this.isTournamentGame?(h=this.personality.playerStats,PWG.App.saveData("needsPlayerStatMessage",!1),e.closeCallback&&c(2)):i[this.name]+f<i[this.opponentName]&&!this.isLosing?(h=b(this.personality,"player","leading"),this.isLosing=!0,this.isWinning=!1):h=b(this.personality,"dealer","startTurn"):i[this.name]>i[this.opponentName]+f&&!this.isWinning?(h=b(this.personality,"dealer","leading"),this.isWinning=!0,this.isLosing=!1):h=b(this.personality,"player","startTurn")}return h},a.prototype.getRollComment=function(a,c,d){var e=PWG.Players.getIsAITurn(a),f="";return e?c?f=b(this.personality,"dealer","negative"):d&&(f=b(this.personality,"dealer","positive")):c?f=b(this.personality,"player","negative"):d&&(f=b(this.personality,"player","positive")),f},a.prototype.getWinComment=function(a){var c="";return c=a.name===this.name?b(this.personality,"dealer","won"):b(this.personality,"player","won")},e.gameEndCommentGiven=!1,e.playerStatsCommentGiven=!1,e.create=function(b,c){var d=new a(b,c);return e.activeComments=PWG.Utils.clone(d.personality),e.previousComment={game:{start:-1},dealer:{startTurn:-1,positive:-1,negative:-1,leading:-1,won:-1},player:{startTurn:-1,positive:-1,negative:-1,leading:-1,won:-1}},d},e.setCloseCallback=function(a,b){e.closeCallback=a||null,e.closeCallbackContext=b||e},e}();var PWG=PWG||{};PWG.AILogic=function(){"use strict";var a={};return a.selectDice=function(b,c){var d,e=[],f={},g=0,h=0,i=0,j=0;return PWG.Utils.each(b,function(a,b){f[b]="ones"===b?PWG.Farkle.getOnesScore(a.length):"fives"===b?PWG.Farkle.getFivesScore(a.length):PWG.Farkle.getGroupScore(b,a.length),i+=a.length,j+=f[b]},a),PWG.Utils.each(f,function(a,c){a===g?b[c].length<b[d].length&&(d=c,g=a):a>g&&(d=c,g=a),h+=a},a),h>0&&(i+c===6?PWG.Utils.each(b,function(b){PWG.Utils.each(b,function(a){e.push(a)},a)},a):"ones"===d?(b.ones.length>2?e=b[d]:3>c?e.push(b.ones[0]):e=b[d],b.fives&&(e=a.checkForSmallerScorerAdd(c,e,b.fives))):"fives"===d?(b.fives.length>2?e=b[d]:3>c?e.push(b.fives[0]):e=b[d],b.ones&&(e=a.checkForSmallerScorerAdd(c,e,b.ones))):(e=b[d],(b.ones||b.fives)&&(b.ones&&b.fives?c+e.length+b.ones.length+b.fives.length===0&&(e=e.concat(b.ones),e=e.concat(b.fives)):("ones"!==d&&b.ones&&(e=a.checkForSmallerScorerAdd(c,e,b.ones)),"fives"!==d&&b.fives&&(e=a.checkForSmallerScorerAdd(c,e,b.fives)))))),e},a.sortDice=function(b){var c={};return PWG.Utils.each(b,function(a){a.isActive&&(a.groupId?(c[a.groupId]||(c[a.groupId]=[]),c[a.groupId].push(a)):1===a.value?(c.ones||(c.ones=[]),c.ones.push(a)):5===a.value&&(c.fives||(c.fives=[]),c.fives.push(a)))},a),c},a.checkForSmallerScorerAdd=function(a,b,c){return c.length>2?b=b.concat(c):a+(b.length+c.length)>=5?b=b.concat(c):0===b.length&&c.length>0&&b.push(c.pop()),b},a}();var PWG=PWG||{};PWG.AIPlayer=function(){"use strict";function a(b){b.isAIPlayer=!0,a._super.constructor.call(this,b),this.isGUIGame=b.isGUIGame,this.gameId=b.gameId,this.rolledDice,this.turnScore,this.usedDice,this.resumeAction=null}PWG.Utils.inherit(a,PWG.Player);var b=1300,c=3,d=5,e=3,f=700,g=1e3;return a.prototype.resume=function(){a._super.resume.call(this),this.resumeAction&&(this.resumeAction.method.call(this,this.resumeAction.params),this.resumeAction=null)},a.prototype.startTurn=function(){this.rolledDice={},this.turnScore=0,this.usedDice=0,this.totalUsedDice=0,this.doAction(this.roll)},a.prototype.roll=function(){this.isPaused?this.resumeAction={method:this.roll,params:null}:PWG.Games.roll(this.gameId)},a.prototype.hasFarkled=function(){this.turnScore=0,a._super.hasFarkled.call(this)},a.prototype.setRolledDice=function(a){this.rolledDice=a,this.doAction(this.selectDice)},a.prototype.selectDice=function(){var a=PWG.AILogic.selectDice(PWG.AILogic.sortDice(this.rolledDice.collection),this.usedDice);a.length>0?(this.totalUsedDice=this.usedDice+=a.length,this.usedDice>=6&&(this.usedDice=0),this.isPaused?this.resumeAction={method:this.submitSelectedDice,params:a}:this.submitSelectedDice(a)):this.isPaused?this.resumeAction={method:this.endTurn,params:null}:this.doAction(this.endTurn),this.rolledDice={}},a.prototype.submitSelectedDice=function(a){PWG.Games.selectDice(this.gameId,a),this.doAction(this.completeSelection)},a.prototype.completeSelection=function(){PWG.Games.selectionComplete(this.gameId)},a.prototype.updateTurnScore=function(a,b){var h;this.turnScore=a,this.score>=PWG.Farkle.WINNING_SCORE?this.doAction(this.endTurn):b?this.doAction(this.roll):this.turnScore>=g?(h=PWG.Utils.diceRoll(),this.doAction(h>d?this.roll:this.endTurn)):this.turnScore>=PWG.Farkle.MIN_TURN_SCORE?this.currentFarkles===PWG.Farkle.NUM_FARKLES_BEFORE_DEDUCTION-1?this.doAction(this.endTurn):this.totalUsedDice>e?this.turnScore<f?(h=PWG.Utils.diceRoll(),this.doAction(h>c?this.roll:this.endTurn)):this.doAction(this.endTurn):this.doAction(this.roll):this.doAction(this.roll)},a.prototype.doAction=function(a){if(this.isGUIGame){var c=PWG.Timer.create();c.start(b,function(a,b){b.action.call(b.context),PWG.Timer.remove(a.id)},{action:a,context:this},this)}else a.call(this)},a.prototype.endTurn=function(){this.turnScore=0,PWG.Games.endTurn(this.gameId)},a}();var PWG=PWG||{};PWG.Players=function(){"use strict";var a={};a.TUTORIAL_PLAYER_NAME="student";var b={},c={},d={};return a.getCurrent=function(a){return-1===c[a]?null:b[a][c[a]]},a.getAll=function(a){return b[a]},a.get=function(){return b},a.getIsAITurn=function(a){return d[a]},a.getSinglePlayerName=function(c){var d;return PWG.Utils.each(b[c],function(a){a.isAIPlayer||(d=a.name)},a),d},a.getPlayer=function(c,d){var e=null;return PWG.Utils.each(b[c],function(a){a.name===d&&(e=a)},a),e},a.getScores=function(c){var d={};return PWG.Utils.each(b[c],function(a){d[a.name]=a.score},a),d},a.getAllPlayerStats=function(c){var d={};return PWG.Utils.each(b[c],function(a){d[a.name]=a.getStats()},a),d},a.create=function(d,e,f,g,h){c[d]=-1;var i=[];PWG.Utils.each(e,function(a){var b;b=f.hasOwnProperty(a.name)?f[a.name]:a,b.isGUIGame=g,b.isTournamentGame=h,b.gameId=d;var c=a.isAIPlayer?new PWG.AIPlayer(b):new PWG.Player(b);i.push(c)},a),b[d]=i},a.startGame=function(b){c[b]=0,a.resume(b)},a.incrementTurn=function(a){b[a][c[a]].turns++},a.startTurn=function(a){return b[a][c[a]].isAIPlayer?(d[a]=!0,b[a][c[a]].startTurn()):d[a]=!1,d[a]},a.hasHotDice=function(a,d){b[a][c[a]].hasHotDice(d)},a.hasFarkled=function(a){b[a][c[a]].hasFarkled()},a.setRolledDice=function(a,d){b[a][c[a]].isAIPlayer&&b[a][c[a]].setRolledDice(d)},a.updateTurnScore=function(a,d,e){b[a][c[a]].isAIPlayer&&b[a][c[a]].updateTurnScore(d,e)},a.onTurnEnded=function(a,d,e){b[a][c[a]].onTurnEnded(d,e)},a.nextPlayer=function(a){c[a]<b[a].length-1?c[a]++:c[a]=0},a.gameOver=function(d){var e;return PWG.Utils.each(b[d],function(a,b){a.hasFinishedGame(),b===c[d]&&(a.hasWon(),e=a)},a),e},a.hasWonTournament=function(a){b[a][c[a]].hasWonTournament()},a.pause=function(a){PWG.Utils.each(b[a],function(a){a.pause()},this)},a.resume=function(a){PWG.Utils.each(b[a],function(a){a.resume()},this)},a.quit=function(a){c[a]=-1,b[a]=[]},a}();var PWG=PWG||{};PWG.PlayerAnimalHomes={dog:"forest",rabbit:"savannah",fish:"ocean",cat:"jungle"},PWG.Animals=function(){var a={},b=7,c={forest:["bear","wolf","fox","lynx","beaver","deer","hawk","squirrel"],ocean:["shark","whale","squid","barracuda","stingray","crab","dolphin","penguin"],savannah:["lion","cobra","badger","elk","vulture","jackal","rhino","camel"],jungle:["gorilla","panther","python","elephant","cockatoo","crocodile","bat","monkey"]};return a.locations=c,a.guides={forest:c.forest[b],savannah:c.savannah[b],ocean:c.ocean[b],jungle:c.jungle[b]},a.getLocationsLength=function(){return PWG.Utils.objLength(c)},a.getLocationKeys=function(){return Object.keys(c)},a.getHome=function(a){var b=PWG.Utils.find(c,a);for(var d in c)if(~c[d].indexOf(a)){b=d;break}return b},a}();var PWG=PWG||{};PWG.GUIDie=function(){function a(a,b,c,d,e,f){this.idx=a,this.id=c,this.value=b,this.isSelected=!1,this.isScorable=e,this.groupId=f,this.styleString="",this.el=document.createElement("div"),this.el.className="die die_"+b,this.el.setAttribute("id",c),this.styleString="width: "+PWG.GUIDice.dieWidthHeight+"px;",this.styleString+="height: "+PWG.GUIDice.dieWidthHeight+"px;",d.appendChild(this.el)}return a.prototype.destroy=function(){this.clickHandler&&this.el.removeEventListener("click",this.clickHandler),this.touchController&&this.touchController.destroy()},a}();var PWG=PWG||{};PWG.RolledDie=function(){function a(h,i,j,k,l,m,n){a._super.constructor.call(this,h,i,j,k,l,m);var o=[],p=Math.floor(h*PWG.GUIDice.dieDiameter+9*PWG.GUIDice.unit+f);if(this.animatedStyleString="left:"+p+"px;",o.push({key:"left",begin:k.clientWidth,end:p,unit:"px"}),PWG.GUIDice.randomPositions){var q;q=Math.floor(0===h||5===h?Math.random()*(PWG.GUIDice.rollingGreenRect.height-(PWG.GUIDice.dieDiameter+PWG.GUIDice.playScreenRect.height/6+10*PWG.GUIDice.unit)):Math.random()*(PWG.GUIDice.rollingGreenRect.height-PWG.GUIDice.dieDiameter)+3*PWG.GUIDice.unit),this.animatedStyleString+="top:"+q+"px;",o.push({key:"top",begin:q+200,end:q,unit:"px"})}if(PWG.GUIDice.randomRotations){var r=Math.floor(360*Math.random()),s=(PWG.Utils.coinToss(),PWG.Utils.parseMarkup(g,{rotation:r}));this.styleString+=" "+s}if(!n)if(l)if(this.el.className+=d,PWG.App.isAndroid){var t={move:{fn:PWG.GUIDice.touchMove,ctx:this},end:{fn:PWG.GUIDice.touchEnd,ctx:this}};this.touchController=PWG.TouchManager.add(this.el,t)}else this.el.className+=d,this.clickHandler=function(a){return function(){PWG.GUIDice.addDieToBank(a)}}(this),this.el.addEventListener("click",this.clickHandler);else PWG.App.isTutorialActive&&(this.el.className+=e);var u={styleString:this.styleString,id:this.id,idx:this.idx};if(PWG.GUIDice.animateDice){var v=Math.floor(Math.random()*(b-c)+c);PWG.Animator.create(this.el,o,v,!0,function(a,b,c){PWG.GUIDice.dieAdded(b,c)},this,u)}else this.el.setAttribute("style",this.styleString+this.animatedStyleString),PWG.GUIDice.dieAdded(this.el,u)
}PWG.Utils.inherit(a,PWG.GUIDie);var b=300,c=10,d=" selectable_die",e=" non_scoring_die",f=15,g=" transform:rotate(~{rotation}~deg);-ms-transform:rotate(~{rotation}~deg);-webkit-transform:rotate(~{rotation}~deg);";return a}();var PWG=PWG||{};PWG.BankedDie=function(){function a(b,c,d,e,f,g){a._super.constructor.call(this,b,c,d,e,f,g),this.styleString+="left:"+b*PWG.GUIDice.dieDiameter+"px;",this.styleString+="top:0px;";var h={styleString:this.styleString,id:this.id,idx:this.idx};this.el.setAttribute("style",this.styleString),PWG.GUIDice.dieAdded(this.el,h)}return PWG.Utils.inherit(a,PWG.GUIDie),a}();var PWG=PWG||{};PWG.GUIDice=function(){"use strict";var a={},b=25;return a.gui=null,a.dice={},a.rollingGreenRect={},a.playScreenRect={},a.dieDiameter=0,a.dieWidthHeight=0,a.unit=0,a.randomPositions=!0,a.randomRotations=!0,a.animateDice=!0,a.init=function(b){a.gui=b},a.getDieById=function(b,c){return a.dice[c].hasOwnProperty(b)?a.dice[c][b]:void 0},a.addDie=function(b,c,d,e,f,g,h){a.dice[b]||(a.dice[b]={});var i=b+c+"-"+String((new Date).getTime())+"-"+String(Math.floor(99*Math.random()));if(f)var j=new PWG.RolledDie(c,d,i,e,g,h);else var j=new PWG.BankedDie(c,d,i,e,g,h);a.dice[b][i]=j},a.addDiceWithTimer=function(c,d,e){var f=PWG.Timer.create();a.callback=d,a.context=e||a,a.diceAdded=0,a.numToAdd=0;var g="rolledDice"===c.name?!0:!1;f.loop(b,function(b,c){var d=c.collection[c.idx];d.isActive&&(a.numToAdd++,a.addDie(c.name,c.idx,d.value,c.parentEl,g,d.isScorable,d.groupId,c.isAITurn)),c.idx++,c.idx===c.collection.length&&PWG.Timer.remove(b.id)},c,a)},a.dieAdded=function(){a.diceAdded++,a.diceAdded===a.numToAdd&&a.allDiceAdded()},a.allDiceAdded=function(){a.numToAdd=0,a.callback&&a.callback.call(a.context)},a.getDice=function(b){return a.dice.hasOwnProperty(b)?a.dice[b]:void 0},a.updateSizes=function(){var b="landscape"===PWG.WindowParams.orientation?PWG.WindowParams.height:PWG.WindowParams.width;("portrait"===PWG.WindowParams.orientation||PWG.App.isTutorialActive)&&(b*=.75);var c=b/6*.85;a.dieDiameter=c,a.dieWidthHeight=Math.floor(Math.sqrt(Math.pow(c,2)/2))},a.resizeDice=function(b,c){PWG.Utils.each(b,function(b){var d=b.el.getAttribute("style"),e=d.substr(d.indexOf("top"),d.length),f="width:"+a.dieWidthHeight+"px;height:"+a.dieWidthHeight+"px;"+e;if(c){var g=b.idx*a.dieDiameter+7*a.unit;f+="left:"+g+"px;"}else f+="left:"+b.idx*a.dieDiameter+"px;";b.el.setAttribute("style",f)},this)},a.touchMove=function(b,c){c.style.left=b.pageX-c.clientWidth/2+"px",c.style.top=b.pageY-c.clientHeight/2-a.rollingGreenRect.top+"px"},a.touchEnd=function(b,c){c.style.left=b.pageX-c.clientWidth/2+"px",c.style.top=b.pageY-c.clientHeight/2-a.rollingGreenRect.top+"px",b.pageY>=a.bankRect.top&&a.addDieToBank(this)},a.addDieToBank=function(b){if(a.selectedDice={},b.isSelected=!0,a.selectedDice[b.id]=b.idx,a.gui.toSelect[b.id]=b.idx,""!==b.groupId){var c=b.groupId,d=a.dice.rolledDice;PWG.Utils.each(d,function(b){b.groupId===c&&(b.isSelected||(b.isSelected=!0,a.selectedDice[b.id]=b.idx,a.gui.toSelect[b.id]=b.idx))},a)}PWG.Utils.each(a.selectedDice,function(b,c){a.gui.addDieToBank(c)},a)},a.bankSelectionComplete=function(){a.gui.allDiceMovedToBank()},a}();var PWG=PWG||{};PWG.SafariTemplates={TOURNAMENT_NEW:'<div id="tournament_choice_~{idx}~" class="location_choice choice_box ~{xPos}~ ~{yPos}~"><div id="" class="tournament_add_icon plus_control controls" data-id="~{id}~" data-idx="~{idx}~"></div><div id="tournament_~{idx}~_highlight" class="selection_highlight"></div></div>',TOURNAMENT_CONTINUE:'<div id="tournament_choice_~{idx}~" class="location_choice choice_box ~{xPos}~ ~{yPos}~"><div id="" class="choice_icon player_animal_spritesheet ~{userAnimal}~" data-id="~{id}~" data-idx="~{idx}~"></div><div id="tournament_~{idx}~_highlight" class="selection_highlight"></div></div>',BRACKET_PLAYER_ELEMENTS:'<div id="tournament_contender_~{name}~" class="bracket_contender ~{name}~ ~{contenderClass}~ ~{xPos}~ ~{yPos}~"></div>',PLAYER_GAME_ELEMENTS:'<div id="player_name_~{name}~" class="player_name text_xxl text_white no_select" onclick="PWG.SafariGUI.playerElClicked(\'~{name}~\')">~{name}~</div><div id="farkles_~{name}~" class="current_farkles" onclick="PWG.SafariGUI.playerElClicked(\'~{name}~\')"></div><div class="scores"><div id="turn_score_~{name}~" class="turn_score text_lg text_white no_select" onclick="PWG.SafariGUI.playerElClicked(\'~{name}~\')"></div><div id="total_score_~{name}~" class="total_score text_lg text_white no_select" onclick="PWG.SafariGUI.playerElClicked(\'~{name}~\')">game: 0</div></div>',PLAYER_FARKLES:'<div class="farkle_f_icon" style="right: ~{right}~%"></div>',PLAYER_STATS_OPEN:'<div class="~{name}~ player_animal_spritesheet player_icon"></div><div id="player_statistics_~{name}~" class="player_statistics text_xl text_right"><b>~{name}~</b>',AI_PLAYER_STATS_OPEN:'<div class="~{name}~ npc_animal_bg ~{location}~_animal_spritesheet ai_player_icon"></div><div id="player_statistics_~{name}~" class="player_statistics text_xl text_right"><b>~{name}~</b>',PLAYER_STATS_DETAIL:'<div id="player_stats_~{key}~" class="player_stats text_md">~{value}~</div>',PLAYER_STATS_CLOSE:"</div>",CLOSE_BUTTON:'<div id="close_button" class="control controls button1 cancel_control"></div>',NOTIFICATION:'<div id="notification" class="~{className}~"></div>'};var PWG=PWG||{};PWG.SafariAnimator=function(){function a(a){this.params=a,a.delay&&a.delay>0?(this.delayTimer=PWG.Timer.create(),this.delayTimer.start(this.params.delay,function(a){PWG.Timer.remove(a.id),this.start()},this.params,this)):this.start()}var b={},c=" animate_left_onto_half_screen",d=" animate_versus_onto_screen",e=" dealer_on_screen animate_right_onto_half_screen",f=" dealer_off_screen animate_right_off_half_screen",g=" animate_down_onto_screen",h=300,i=500;return a.prototype.start=function(){this.params.duration?(this.durationTimer=PWG.Timer.create(),this.durationTimer.start(this.params.duration,function(a){PWG.Timer.remove(a.id),this.onAnimationComplete()},this.params,this)):this.onAnimationComplete(),this.params.el.style.display="block",this.params.el.className=this.params.currentClass+this.params.newClass},a.prototype.onAnimationComplete=function(){this.params.callback&&this.params.callback.call(this.params.context)},b.animateOpponentOntoScreen=function(a,c,d,f){b.animate(a,c,e,h,i,d,f)},b.animateOpponentOffScreen=function(a,c,d,e){b.animate(a,c,f,h,i,d,e)},b.animatePlayerOntoScreen=function(a,d,e,f){b.animate(a,d,c,h,i,e,f)},b.animateVersusOntoScreen=function(a,c,e){b.animate(a,"",d,h,h,c,e)},b.animateTrophyOntoScreen=function(a,c,d,e){b.animate(a,c,g,h,i,d,e)},b.animate=function(c,d,e,f,g,h,i){{var j={el:c,currentClass:d||"",newClass:e,duration:f||0,delay:g||0,callback:h||null,context:i||b};new a(j)}},b}();var PWG=PWG||{};PWG.SafariGUI=function(){"use strict";var a,b={},c="farkle_splash",d="farkle_splash_game_play",e={forest:" forest_bg",savannah:" savannah_bg",ocean:" ocean_bg",jungle:" jungle_bg"},f="mountain_bg",g="square_screen",h=" start_control controls",i=" roll_control controls",j=" down_control controls",k=" next_control controls",l=" confirm_control controls",m="_animal_spritesheet npc_animal_bg ",n="player_animal_spritesheet ",o="select player",p="select players",q={dog:!1,cat:!1,fish:!1,rabbit:!1},r="newTournament",s=1,t=.66,u=300,v=3e3,w=500,x=5e3,y=10,z=30,A=1,B=10,C=2,D=" animate_right_onto_screen",E={landscape:".players_title_and_info{right:0}.title_and_info{height:15%}.players{width:100%;height:75%;top:25%}.choice_box{background-color:#333;width:30%;padding-bottom:30%;position:absolute;cursor:pointer}",portrait:".players_title_and_info{top:0}.title_and_info{height:25%}.players{width:100%;height:75%;top:25%}.choice_box{background-color:#333;width:30%;padding-bottom:30%;position:absolute;cursor:pointer}"},F=".screen_orientation {width:~{size}~px;height:~{size}~px;left:0;top:~{top}~px;} .double_wide_screen_orientation {width:~{doubleSize}~px;height:~{size}~px;left:0;top:~{top}~px;} .players_title_and_info {width:~{titleWidth}~px;height:~{titleHeight}~px;right:0;}";return b.screenEls={},b.currentScreen="",b.currentTournament=-1,b.previousTournament="",b.currentLocation="",b.previousLocation="",b.currentAI=PWG.Animals.guides[b.currentLocation],b.rolledDice={},b.playerEls={},b.numPlayers=0,b.quitCb=null,b.closeCb=null,b.selectedCb=null,b.button1Callback=null,b.button2Callback=null,b.isTournamentGame=!1,b.isFinalsGame=!1,b.isAIGame=!1,b.isWithDealerPersonality=!0,b.dealerPersonality=null,b.isTransitionedToFinals=!1,b.isConfirmBoxOpen=!1,b.currentGameId=null,b.init=function(){b.initCurrentLocation(),b.createStyleEls(),b.updateSquareStyleEl(),b.currentScreen="welcome",b.cacheElements(),b.addEventListeners(),b.addAnimalChoiceClickHandlers(),b.addLocationChoiceClickHandlers(),b.button1.className+=h,b.button1Class=h,b.layout(),b.showDealerSpeechBubble(PWG.App.isTutorialActive),b.isWithDealerPersonality&&PWG.AIPersonality.setCloseCallback(b.closeDealerSpeech,b),PWG.GUIDice.init(b),b.checkFirstPlay()},b.initCurrentLocation=function(){var a=document.getElementById("tutorial_alert_dealer_icon");b.currentLocation=b.opponentLocation=PWG.Utils.randomKey(PWG.Animals.locations),b.screenEls.welcome=document.getElementById("welcome_screen"),b.screenEls.welcome.className+=b.currentLocation+"_bg",b.currentAI=PWG.Animals.guides[b.currentLocation],a.className=b.currentLocation+"_animal_spritesheet npc_animal_bg "+b.currentAI},b.createStyleEls=function(){a=document.getElementsByTagName("head")[0],PWG.StyleElManager.create(E),PWG.WindowParams.update(),PWG.StyleElManager.update();var c=document.createElement("style");c.setAttribute("id",g),b.squareStyleEl=c,a.appendChild(c)},b.cacheElements=function(){b.titleButton=document.getElementById("farkle_splash"),b.screenEls.home=document.getElementById("home_screen"),b.tournamentButton=document.getElementById("tournament_button"),b.practiceGameButton=document.getElementById("practice_game_button"),b.multiplayerGameButton=document.getElementById("multiplayer_game_button"),b.screenEls.tournament=document.getElementById("tournament_screen"),b.screenEls.bracket=document.getElementById("bracket_screen"),b.bracketLeftEl=document.getElementById("bracket_left"),b.bracketRightEl=document.getElementById("bracket_right"),b.bracketNextButton=document.getElementById("bracket_next_button"),b.bracketCloseButton=document.getElementById("bracket_close_button"),b.screenEls.location=document.getElementById("location_screen"),b.screenEls.animal=document.getElementById("animal_screen"),b.playerChoiceTitle=document.getElementById("choice_title"),b.screenEls.rules=document.getElementById("rules_screen"),b.rulesButton=document.getElementById("rules_button"),b.dealerIcon=document.getElementById("dealer_icon"),b.dealerSpeech=document.getElementById("dealer_speech"),b.dealerSpeechTextEl=document.getElementById("dealer_speech_text"),b.tutorialButton=document.getElementById("tutorial_button"),b.screenEls.play=document.getElementById("play_screen"),b.screenEls.stats=document.getElementById("stats_screen"),b.notificationHolder=document.getElementById("notification_holder"),b.button1=document.getElementById("button1"),b.button2=document.getElementById("button2")},b.addEventListeners=function(){b.addCloseButtonListeners(),b.screenEls.welcome.addEventListener("click",b.onWelcomeScreenClick),b.titleButton.addEventListener("click",b.onTitleClick),b.tournamentButton.addEventListener("click",b.onTournamentClick),b.practiceGameButton.addEventListener("click",b.onPracticeGameClick),b.multiplayerGameButton.addEventListener("click",b.onMultiplayerGameClick),b.rulesButton.addEventListener("click",b.onRulesClick),b.tutorialButton.addEventListener("click",b.onTutorialClick),b.button1.addEventListener("click",b.onButton1Click),b.button2.addEventListener("click",b.onButton2Click),b.bracketCloseButton.addEventListener("click",b.onCloseButtonClick),b.bracketNextButton.addEventListener("click",b.onBracketNextClick),window.addEventListener("resize",b.layout),window.addEventListener("orientationchange",b.layout),window.addEventListener("beforeunload",b.houseKeeping)},b.addCloseButtonListeners=function(){var a;PWG.Utils.each(b.screenEls,function(c,d){"welcome"!==d&&"play"!==d&&(a=document.getElementById(d+"_close_button"),a.addEventListener("click",b.onCloseButtonClick))},b)},b.removeEventListeners=function(){b.removeCloseButtonListeners(),b.screenEls.welcome.removeEventListener("click",b.onWelcomeScreenClick),b.titleButton.removeEventListener("click",b.onTitleClick),b.tournamentButton.addEventListener("click",b.onTournamentClick),b.practiceGameButton.removeEventListener("click",b.onPracticeGameClick),b.multiplayerGameButton.removeEventListener("click",b.onMultiplayerGameClick),b.rulesButton.removeEventListener("click",b.onRulesClick),b.tutorialButton.removeEventListener("click",b.onTutorialClick),b.button1.removeEventListener("click",b.onButton1Click),b.button2.removeEventListener("click",b.onButton2Click),b.bracketCloseButton.removeEventListener("click",b.onCloseButtonClick),b.bracketNextButton.removeEventListener("click",b.onBracketNextClick),window.removeEventListener("resize",b.layout),window.removeEventListener("orientationchange",b.layout),window.removeEventListener("beforeunload",b.houseKeeping)},b.removeCloseButtonListeners=function(){var a;PWG.Utils.each(b.screenEls,function(c,d){"welcome"!==d&&"play"!==d&&(a=document.getElementById(d+"_close_button"),a.removeEventListener("click",b.onCloseButtonClick))},b)},b.addTournamentChoiceClickHandlers=function(a){b.addChoiceClickHandlers(a,"tournamentChoiceClickHandlers","onTournamentChoiceClicked")},b.addLocationChoiceClickHandlers=function(){b.addChoiceClickHandlers(e,"locationChoiceClickHandlers","onLocationChoiceClicked")},b.addAnimalChoiceClickHandlers=function(){b.addChoiceClickHandlers(q,"animalChoiceClickHandlers","onAnimalChoiceClicked")},b.addChoiceClickHandlers=function(a,c,d){var e;b[c]={},e=Object.keys(a);for(var f=0,g=e.length;g>f;f++){var h=document.getElementById(e[f]),i=function(a){return function(b){a[d](b)}}(b);b[c][e[f]]=i,h.addEventListener("click",i)}},b.removeTournamentChoiceClickHandlers=function(){b.removeChoiceClickHandlers("div.tournament_choice","tournamentChoiceClickHandlers")},b.removeLocationChoiceClickHandlers=function(){b.removeChoiceClickHandlers("div.location_choice","locationChoiceClickHandlers")},b.removeAnimalChoiceClickHandlers=function(){b.removeChoiceClickHandlers("div.player_animal_choice","animalChoiceClickHandlers")},b.removeChoiceClickHandlers=function(a,c){for(var d=document.querySelectorAll(a),e=d.length,f=0;e>f;f++)d[f].removeEventListener("click",b[c][d[f]]),delete b[c][d[f]]},b.checkFirstPlay=function(){if(PWG.App.getIsFirstPlay()){document.getElementById("tutorial_alert").style.display="block";var a=(document.getElementById("tutorial_alert_dealer_holder"),document.getElementById("tutorial_alert_dealer_icon"));b.isTournamentGame||(b.opponentLocation=b.currentLocation),PWG.SafariAnimator.animateOpponentOntoScreen(a,a.className,b.onTutorialAlertDealerIn,b)}else document.getElementById("logo_dice").style.display="block"},b.onTutorialAlertDealerIn=function(){var a=document.getElementById("tutorial_alert_dealer_speech"),c=PWG.Timer.create(),d={el:a};c.start(w,function(a,d){d.el.style.display="block",PWG.Timer.remove(c.id),b.onTutorialAlertSpeechDisplayed()},d,b)},b.onTutorialAlertSpeechDisplayed=function(){var a=document.getElementById("tutorial_alert_dealer_speech");b.tutorialAlertDealerSpeechText=document.getElementById("tutorial_alert_dealer_speech_text"),b.updateText("tutorialAlertDealerSpeechText",PWG.Tutorial.FIRST_TIME_PLAYER);var c=PWG.Timer.create(),d={el:a};c.start(x,function(a,d){d.el.parentNode&&d.el.parentNode.removeChild(d.el),PWG.Timer.remove(c.id),b.onTutorialAlertSpeechRemoved()},d,b)},b.onTutorialAlertSpeechRemoved=function(){var a=document.getElementById("tutorial_alert_dealer_icon");b.animateOpponentOffOfScreen(a,b.onTutorialAlertDealerOut,b)},b.onTutorialAlertDealerOut=function(){document.getElementById("tutorial_alert").style.display="none",PWG.App.setIsFirstPlay(!1)},b.onWelcomeScreenClick=function(){PWG.App.isMobile&&PWG.DeviceUtils.enterFullScreen(),document.getElementById("logo_dice").style.display="none",document.getElementById("start_message").style.display="none",b.openScreen("home",null)},b.onTitleClick=function(){if(b.showDealerSpeechBubble(!1),PWG.App.isTutorialActive=!1,"home"!==b.currentScreen)switch(b.currentScreen){case"play":b.isAIGame?PWG.Players.getIsAITurn(b.currentGameId)||PWG.App.quit():PWG.App.quit();break;case"rules":b.closeScreen("rules");break;case"welcome":b.onWelcomeScreenClick()}},b.onRulesClick=function(){b.openScreen("rules")},b.onTutorialClick=function(){var a=PWG.Players.TUTORIAL_PLAYER_NAME,c={};c[a]={name:a},b.dealerPersonality&&(b.dealerPersonality=null),b.isAIGame=!1,PWG.App.isTutorialActive=!0,b.createGame(c)},b.showDealerSpeechBubble=function(a){b.dealerSpeech.style.display=a?"block":"none"},b.onCloseButtonClick=function(){b.closeScreen(b.currentScreen)},b.onTournamentClick=function(){b.openScreen("tournament",b.onTournamentScreenOpened)},b.onTournamentScreenOpened=function(){var a=PWG.Tournaments.getActive(),c=Object.keys(a),d=document.getElementById("tournament_menu"),e={},f="";b.currentTournament=-1,b.isTournamentGame=!0,b.isTournamentOver=!1,b.isAIGame=!0,b.isTournamentAnimalSelected=!1,b.isTransitionedToFinals=!1,b.existingTournamentAnimals=[];var g=document.getElementById("tournament_next_button");g.style.display="none",g.addEventListener("click",b.onTournamentSelected),c.length<4&&c.push(r),PWG.Utils.each(c,function(c,d){var g=d%2===0?"choice_left":"choice_right",h=2>d?"choice_top":"choice_bottom",i={idx:d,xPos:g,yPos:h};a.hasOwnProperty(c)?(b.existingTournamentAnimals.push(i.userAnimal=a[c].userAnimal),i.id=a[c].id,f+=PWG.Utils.parseMarkup(PWG.SafariTemplates.TOURNAMENT_CONTINUE,i)):(i.id=r,f+=PWG.Utils.parseMarkup(PWG.SafariTemplates.TOURNAMENT_NEW,i)),e["tournament_choice_"+d]=""},b),d.innerHTML=f,document.getElementById("contender_names").innerHTML="",b.addTournamentChoiceClickHandlers(e),b.tournamentKeys=c},b.onTournamentChoiceClicked=function(a){var c=(a.target.dataset.id,a.target.dataset.idx);c!==b.currentTournament&&(b.currentTournament>-1&&(document.getElementById("tournament_"+b.currentTournament+"_highlight").style.display="none"),document.getElementById("tournament_"+c+"_highlight").style.display="block",b.currentTournament=c),document.getElementById("tournament_next_button").style.display="block"},b.onTournamentSelected=function(){var a=document.getElementById("tournament_next_button");a.removeEventListener("click",b.onTournamentSelected),b.tournamentKeys[b.currentTournament]===r?b.openScreen("animal",b.onAnimalScreenOpened):b.openScreen("bracket",b.onBracketScreenOpened),b.bracketNextButton.parentNode.removeChild(b.bracketNextButton),b.bracketCloseButton.parentNode.removeChild(b.bracketCloseButton),b.bracketLeftEl.appendChild(b.bracketNextButton),b.bracketLeftEl.appendChild(b.bracketCloseButton)},b.onTournamentAnimalSelected=function(){var a,c;b.isTournamentAnimalSelected=!0,PWG.Utils.each(b.selectedPlayerAnimals,function(b,c){b&&(a=c)},b),b.currentTournament=b.tournamentKeys.length,c=PWG.Tournaments.create(a),b.tournamentKeys.push(c),PWG.Tournaments.start(c),b.closeScreen("animal"),b.openScreen("bracket",b.onBracketScreenOpened)},b.onBracketScreenOpened=function(){var a=PWG.Tournaments.getAll("tournaments"),c=a[b.tournamentKeys[b.currentTournament]],d=c.rounds,f=b.currentLocation=c.userHome,g="";b.selectedPlayerAnimals={},b.selectedPlayerAnimals[c.userAnimal]=!0,b.transitionToFinals=!1,b.isFinalsGame=!1;var g=b.processTournamentNamesAndLocations(d[f],c,!1);if(c.locationChampions[f]&&(g+=PWG.Utils.parseMarkup(PWG.SafariTemplates.BRACKET_PLAYER_ELEMENTS,{xPos:"bracket_location_column_3",yPos:"bracket_location_row_0_3",name:c.locationChampions[f],contenderClass:"player_contender"})),document.getElementById("tournament_state_bg").className=" location_bg "+e[f],PWG.Utils.objLength(c.locationChampions)===PWG.Animals.getLocationsLength()){b.isTransitionedToFinals||(b.transitionToFinals=!0,b.isTransitionedToFinals=!0),b.isFinalsGame=!0;var h=b.processTournamentNamesAndLocations(d[PWG.Tournaments.FINALS],c,!0);document.getElementById("finalist_names").innerHTML=h,PWG.Utils.each(b.locationBackgroundThumbs,function(a,b){if(4>b){var c=document.getElementById("location"+b);c.className="mini_location_bg location_bg "+a}},b)}document.getElementById("contender_names").innerHTML=g},b.processTournamentNamesAndLocations=function(a,c,d){var e="";return b.locationBackgroundThumbs=[],PWG.Utils.each(a,function(a,f){var g,h,i,j=0,k=d?f+1:f,l="bracket_location_column_"+k,m=d?"bracket_finals_row_":"bracket_location_row_";PWG.Utils.each(a.contenders,function(k){PWG.Utils.each(k,function(n,o){n===c.userAnimal?(b.currentAI=0===o?k[1]:k[0],b.currentGameId=a.userGameId,i="player_contender",d?(b.locationBackgroundThumbs.push(c.userHome+"_bg"),b.opponentLocation=PWG.Animals.getHome(b.currentAI)):b.opponentLocation=b.currentLocation):(h=PWG.Animals.getHome(n),i=h+"_contender",d&&b.locationBackgroundThumbs.push(h+"_bg")),g=m+j+"_"+f,e+=PWG.Utils.parseMarkup(PWG.SafariTemplates.BRACKET_PLAYER_ELEMENTS,{xPos:l,yPos:g,name:n,contenderClass:i}),j++},b)},b)},b),e},b.onBracketNextClick=function(){b.transitionToFinals?(b.transitionToFinals=!1,b.animateToFinals()):b.continueToTournament()},b.animateToFinals=function(){var a=[{key:"left",begin:"0",end:"-100",unit:"%"}],c=150;b.bracketLeftEl.removeChild(b.bracketNextButton),b.bracketLeftEl.removeChild(b.bracketCloseButton);PWG.Animator.create(b.screenEls.bracket,a,c,!0,b.onAnimatedToFinals,b,{styleString:"display:block "})},b.onAnimatedToFinals=function(){b.bracketRightEl.appendChild(b.bracketNextButton),b.bracketRightEl.appendChild(b.bracketCloseButton)},b.continueToTournament=function(){b.initializeGameAI(),b.addAllPlayers()},b.onPracticeGameClick=function(){b.gameTypeSelected(!0)},b.onMultiplayerGameClick=function(){b.gameTypeSelected(!1)},b.gameTypeSelected=function(a){b.isTournamentGame=!1,b.dealerIcon.style.display=a?"block":"none",b.isWithDealerPersonality=b.isAIGame=a,PWG.App.isTournamentGame||b.openScreen("location",b.onLocationSelectionScreenOpened)},b.onLocationSelectionScreenOpened=function(){b.previousPlayerSelection="",PWG.Utils.each(e,function(a,c){var d=document.getElementById(c+"_highlight");d.style.display=c===b.currentLocation?"block":"none"},b);var a=document.getElementById("location_next_button");a.addEventListener("click",b.onLocationSelected)},b.onLocationChoiceClicked=function(a){var c=a.target.id;c!==b.currentLocation&&(""!==b.currentLocation&&(document.getElementById(b.currentLocation+"_highlight").style.display="none"),document.getElementById(c+"_highlight").style.display="block"),b.currentLocation=b.opponentLocation=c},b.onLocationSelected=function(){trace("onLocationSelected, currentLocation = "+b.currentLocation+", opponentLocation = "+b.opponentLocation);var a=document.getElementById("location_next_button");a.removeEventListener("click",b.onLocationSelected),b.initializeGameAI(),b.openScreen("animal",b.onAnimalScreenOpened)},b.initializeGameAI=function(){b.isAIGame&&(b.isTournamentGame||(b.currentAI=PWG.Animals.guides[b.currentLocation]),b.dealerIcon.className=b.opponentLocation+m+" "+b.currentAI),b.dealerPersonality=b.isWithDealerPersonality?PWG.AIPersonality.create(b.currentAI,b.isTournamentGame):null},b.onAnimalScreenOpened=function(){var a={},c=document.getElementById("animal_next_button");if(b.isTournamentGame){var d=PWG.Tournaments.getActiveAnimals();PWG.Utils.each(q,function(b,c){-1===d.indexOf(c)&&(a[c]=!1)},b),c.removeEventListener("click",b.addAllPlayers),c.addEventListener("click",b.onTournamentAnimalSelected)}else a=q,c.removeEventListener("click",b.onTournamentAnimalSelected),c.addEventListener("click",b.addAllPlayers);b.selectedPlayerAnimals=PWG.Utils.clone(q),b.previousPlayerSelection="",PWG.Utils.each(q,function(b,c){var d=document.getElementById(c+"_choice");d.style.opacity=a.hasOwnProperty(c)?1:.3,document.getElementById(c+"_highlight").style.display="none"},b),b.isAIGame||b.isTournamentGame?b.updateText("playerChoiceTitle",o):b.updateText("playerChoiceTitle",p),c.style.display="none"},b.onAnimalChoiceClicked=function(a){var c=a.target.id,d=!1;b.selectedPlayerAnimals[c]=!b.selectedPlayerAnimals[c],b.isAIGame&&""!==b.previousPlayerSelection&&b.previousPlayerSelection!==c&&(b.selectedPlayerAnimals[b.previousPlayerSelection]=!1),PWG.Utils.each(b.selectedPlayerAnimals,function(a,b){document.getElementById(b+"_highlight").style.display=a?"block":"none",a&&(d=!0)},b),document.getElementById("animal_next_button").style.display=d?"block":"none",b.previousPlayerSelection=c},b.addAllPlayers=function(){var a={};PWG.Utils.each(b.selectedPlayerAnimals,function(b,c){b&&(a[c]={name:c})},b),b.isAIGame&&(a[b.currentAI]={name:b.currentAI,isAIPlayer:!0}),b.createGame(a)},b.createGame=function(a){var c=document.getElementById("animal_next_button"),d=document.getElementById("player_icon");b.isTournamentGame||(b.currentGameId=PWG.Games.createGUIGame(a)),c.removeEventListener("click",b.addAllPlayers),b.button1Callback=b.startGame,PWG.App.isTutorialActive?(b.rollingGreen=document.getElementById("inner_green"),b.rollingGreen.style.display="block",document.getElementById("versus_text").style.display="none",d.style.display="none",d.className="",b.dealerIcon.className=b.opponentLocation+m+" "+b.currentAI,b.animateOpponentOntoScreen(b.onGuideAnimatedOntoScreen)):(b.isAIGame&&(b.replaceClass(b.dealerSpeechTextEl,"text_lg","text_xl"),b.showDealerSpeechBubble(!1),b.dealerIcon.style.display="none",d.style.display="none",b.button1.style.display="none",b.animatePlayerOntoScreen()),b.rollingGreen=document.getElementById("rolling_green"),document.getElementById("inner_green").style.display="none",b.showDealerSpeechBubble(!1),document.getElementById("versus_text").style.display="none",d.style.display="none",d.className=""),b.layout(),b.screenEls.play.className="screen screen_orientation location_bg ",b.screenEls.play.className+=b.isFinalsGame?f:e[b.currentLocation],b.openScreen("play"),b.bankEl=document.getElementById("bank"),b.updateRectsAndSizes()},b.animatePlayerOntoScreen=function(){var a=n+PWG.Players.getSinglePlayerName(b.currentGameId),c=document.getElementById("player_icon");PWG.SafariAnimator.animatePlayerOntoScreen(c,a,b.onPlayerAnimatedOntoScreen,b)},b.onPlayerAnimatedOntoScreen=function(){var a=document.getElementById("versus_text");PWG.SafariAnimator.animateVersusOntoScreen(a,b.onVersusAnimatedOntoScreen,b)},b.onVersusAnimatedOntoScreen=function(){b.animateOpponentOntoScreen(b.onOpponentAnimatedOntoScreen)},b.animateOpponentOntoScreen=function(a){b.opponentLocation=b.currentLocation,PWG.SafariAnimator.animateOpponentOntoScreen(b.dealerIcon,b.dealerIcon.className,a,b)},b.onGuideAnimatedOntoScreen=function(){b.button1.style.display="block",b.updateText("dealerSpeechTextEl",PWG.Tutorial.PRE_GAME),b.replaceClass(b.dealerSpeechTextEl,"text_xl","text_lg"),b.showDealerSpeechBubble(!0)},b.onOpponentAnimatedOntoScreen=function(){b.button1.style.display="block"},b.animateOpponentOffOfScreen=function(a,c,d){var e=b.opponentLocation+m+b.currentAI;PWG.SafariAnimator.animateOpponentOffScreen(a,e,c,d)},b.startGame=function(){b.currentGameId?PWG.App.startGame(b.currentGameId):b.openScreen("home")},b.onGameStarted=function(a){PWG.App.isTutorialActive&&b.updateText("dealerSpeechTextEl",PWG.Tutorial.GAME_START),document.getElementById("versus_text").style.display="none";var e=document.getElementById("player_icon");e.style.display="none",e.className="",b.addPlayerEls(a),b.replaceClass(b.titleButton,c,d),b.unit=b.screenEls.play.offsetWidth/100,b.hideButton(b.button1),b.hideButton(b.button2),b.updateButton("button2",k,!0)},b.addPlayerEls=function(a){var c=document.getElementById("players");PWG.Utils.each(a,function(d,e){var f=document.createElement("div");f.setAttribute("id",d.name);var g=PWG.Utils.parseMarkup(PWG.SafariTemplates.PLAYER_GAME_ELEMENTS,d);f.innerHTML=g,f.className="player",f.style.opacity=.5,f.style.width=100/a.length+"%",f.style.left=e*(100/a.length)+"%",b.playerEls[d.name]=f,c.appendChild(f)},b)},b.playerElClicked=function(a){var c,d,e,f;PWG.App.isTutorialActive||("stats"===b.currentScreen&&b.closeScreen("stats"),b.isConfirmBoxOpen||(c=PWG.Players.getPlayer(b.currentGameId,a),c&&(d=c.getStats(),e=c instanceof PWG.AIPlayer?PWG.Utils.parseMarkup(PWG.SafariTemplates.AI_PLAYER_STATS_OPEN,{name:a,location:b.opponentLocation}):PWG.Utils.parseMarkup(PWG.SafariTemplates.PLAYER_STATS_OPEN,{name:a}),PWG.Utils.each(d,function(a,b){if("name"!==b){var c={key:b,value:PWG.Player.detailText[b]+a};e+=PWG.Utils.parseMarkup(PWG.SafariTemplates.PLAYER_STATS_DETAIL,c)}},b),e+=PWG.SafariTemplates.PLAYER_STATS_CLOSE,f=document.getElementById("player_stats_holder"),f.innerHTML=e,b.closeCb=b.playerDetailClosed,b.openScreen("stats"))))},b.playerDetailClosed=function(){PWG.App.isPaused=!1},b.removePlayerEls=function(){var a=document.getElementById("players");PWG.Utils.each(b.playerEls,function(c,d){a.removeChild(c),delete b.playerEls[d]},this)},b.closeDealerSpeech=function(){b.updateText("dealerSpeechTextEl",""),b.showDealerSpeechBubble(!1),b.isEndingGame&&(b.animateOpponentOffOfScreen(b.dealerIcon,b.onDealerAnimatedOffScreen,b),b.isEndingGame=!1)},b.onDealerAnimatedOffScreen=function(){if(b.displayTrophy){var a=document.getElementById("large_trophy");PWG.SafariAnimator.animateTrophyOntoScreen(a,a.className,b.onTrophyDisplayed,b),b.displayTrophy=!1}else b.showButton(b.button2)},b.onTrophyDisplayed=function(){b.showButton(b.button2)},b.startTurn=function(a){b.switchPlayerEl(a.name),b.usedThisTurn=0,b.updateText("turnScore",a.turns+": 0"),b.updateText("totalScore",a.score),b.dealerPersonality&&b.processDealerPersonality(!0)},b.switchPlayerEl=function(a){b.playerTitle=document.getElementById("player_name_"+a),b.totalScore=document.getElementById("total_score_"+a),b.turnScore=document.getElementById("turn_score_"+a),b.farklesText=document.getElementById("farkles_"+a),PWG.Utils.each(b.playerEls,function(b,c){b.style.opacity=c===a?s:t},this)},b.startRoll=function(){if(b.removeDice(b.rolledDice),b.toSelect={},b.selecting=!1,PWG.Players.getIsAITurn(b.currentGameId))b.hideButton(b.button1),b.hideButton(b.button2);else{var a=!1;PWG.App.isTutorialActive&&!PWG.App.tutorial.isPresetRollsActive&&(b.updateText("dealerSpeechTextEl",PWG.Tutorial.TUTORIAL_COMPLETE),b.button2Callback=PWG.App.quit,a=!0),b.updateButton("button1",i,a),b.button1Callback=b.roll}},b.roll=function(){PWG.Games.roll(b.currentGameId)},b.displayRoll=function(a){PWG.App.isTutorialActive&&PWG.App.tutorial.isPresetRollsActive&&b.updateText("dealerSpeechTextEl",PWG.App.tutorial.getPresetRollText()),PWG.Players.getIsAITurn(b.currentGameId)?b.hideButton(b.button1):(b.updateButton("button1",j,!0),b.button1Callback=b.addDiceToBank),b.selecting=!1,b.addRolledDiceDisplayed=!1,b.diceAdded=0,b.numToAdd=0;var c={idx:0,name:"rolledDice",collection:a.collection,keys:Object.keys(a.collection),parentEl:b.rollingGreen,isAITurn:PWG.Players.getIsAITurn(b.currentGameId)},d=function(){b.rolledDiceDisplayed()};PWG.GUIDice.addDiceWithTimer(c,d,b)},b.wiggleRollingGreen=function(){var a=PWG.Timer.create(),c=[{key:"rotate",begin:A,end:-A,unit:""}],d=[{key:"rotate",begin:-A,end:A,unit:""}],e=[{key:"rotate",begin:-A,end:0,unit:""}],f={count:y,time:z,positive:!0,rg:document.getElementById("game_box"),animations1:c,animations2:d,animationEnd:e};a.loop(30,function(a,b){if(b.count--,b.count>0){var c=b.positive?b.animations1:b.animations2;b.positive=!b.positive,PWG.Animator.create(b.rg,c,b.time,!0,null,this,{})}else PWG.Animator.create(b.rg,b.animationEnd,b.time,!0,null,this,{}),a.stop(),PWG.Timer.remove(a.id)},f,b)},b.rolledDiceDisplayed=function(){b.rolledDice=PWG.GUIDice.getDice("rolledDice"),b.addRolledDiceDisplayed=!0,b.hasFarkled&&(b.updateForFarkle(),b.hasFarkled=!1)},b.selectDice=function(a){b.toSelect={},PWG.Utils.each(a,function(a){for(var c in b.rolledDice)b.rolledDice[c].idx===a.idx&&b.selectDie(b.rolledDice[c].id)
},b)},b.selectDie=function(a){var c=b.rolledDice[a];c.isSelected?(c.el.style.opacity=1,c.isSelected=!1,b.removeSelectedDie(c),""===c.groupId||PWG.Players.getIsAITurn(b.currentGameId)||PWG.Utils.each(b.rolledDice,function(a){a.groupId===c.groupId&&(a.el.style.opacity=1,a.isSelected=!1,b.removeSelectedDie(a))},this)):(c.el.style.opacity=.5,c.isSelected=!0,b.addSelectedDie(c),""===c.groupId||PWG.Players.getIsAITurn(b.currentGameId)||PWG.Utils.each(b.rolledDice,function(a){a.groupId===c.groupId&&(a.el.style.opacity=.5,a.isSelected=!0,b.addSelectedDie(a))},this))},b.addSelectedDie=function(a){PWG.App.isTutorialActive&&PWG.App.tutorial.displayFirstBankTutorial&&(PWG.Players.getIsAITurn(b.currentGameId)||(b.updateText("dealerSpeechTextEl",PWG.Tutorial.FIRST_BANK),PWG.App.tutorial.displayFirstBankTutorial=!1)),b.toSelect[a.id]=a.idx,b.checkForSelectedDice()},b.removeSelectedDie=function(a){delete b.toSelect[a.id],b.checkForSelectedDice()},b.checkForSelectedDice=function(){PWG.Players.getIsAITurn(b.currentGameId)||(PWG.Utils.objLength(b.toSelect)>0?b.showButton(b.button1):b.hideButton(b.button1))},b.setSelectedCallback=function(a){b.selectedCb=a},b.onSelectionComplete=function(){b.addDiceToBank()},b.addDiceToBank=function(){b.selecting=!0;var a={idx:1,keys:Object.keys(b.toSelect)};if(b.addDieToBank(a.keys[0]),1===a.keys.length)b.allDiceMovedToBank();else{var c=PWG.Timer.create();c.loop(u,function(a,d){b.addDieToBank(d.keys[d.idx]),d.idx++,d.idx===d.keys.length&&(b.allDiceMovedToBank(),PWG.Timer.remove(c.id))},a,b)}},b.addDieToBank=function(a){var c=b.rolledDice[a];b.removeDie(b.rolledDice[a],b.rolledDice),PWG.GUIDice.addDie("selectedDice",PWG.Utils.objLength(PWG.GUIDice.dice.selectedDice),c.value,b.bankEl),b.usedThisTurn++,b.usedThisTurn>0&&!PWG.Players.getIsAITurn(b.currentGameId)&&(b.button1Callback=PWG.GUIDice.bankSelectionComplete,b.updateButton("button1",l,!1))},b.allDiceMovedToBank=function(){PWG.App.isTutorialActive&&PWG.App.tutorial.displayFirstSelectedTutorial&&(PWG.Players.getIsAITurn(b.currentGameId)||(b.updateText("dealerSpeechTextEl",PWG.Tutorial.FIRST_SELECTION),PWG.App.tutorial.displayFirstSelectedTutorial=!1)),b.selectedDice=PWG.GUIDice.getDice("selectedDice");var a=PWG.Utils.objLength(b.toSelect);a>0&&(b.usedThisTurn%6===0&&b.showHotDice(),PWG.Games.onDiceSelected(b.currentGameId,b.toSelect))},b.showHotDice=function(){PWG.App.isTutorialActive&&PWG.App.tutorial.displayFirstHotDiceTutorial?(b.updateText("dealerSpeechTextEl",PWG.Tutorial.FIRST_HOT_DICE),PWG.App.tutorial.displayFirstHotDiceTutorial=!1):b.wiggleRollingGreen(),b.showNotification("hot_dice_notification"),b.dealerPersonality&&b.processDealerPersonality(!1,!1,!0)},b.farkled=function(a){b.hasFarkled=!0,b.updateText("turnScore",a.turns+": 0"),b.setFarkleIcons(a),b.hideButton(b.button1),PWG.Players.getIsAITurn(b.currentGameId)||(b.button2Callback=b.endTurn),b.updateForFarkle()},b.updateForFarkle=function(){b.addRolledDiceDisplayed?(b.showNotification("farkle_notification"),PWG.Players.getIsAITurn(b.currentGameId)||b.showButton(b.button2),PWG.App.isTutorialActive?(b.button2Callback=b.endTurn,b.button2.style.opacity=1):(b.wiggleRollingGreen(),b.dealerPersonality&&b.processDealerPersonality(!1,!0,!1))):b.hasFarkled=!0},b.showNotification=function(a){var c="fade_out_notification "+a,d=PWG.Utils.parseMarkup(PWG.SafariTemplates.NOTIFICATION,{className:c});b.notificationHolder.innerHTML=d,b.notificationHolder.style.zIndex=1e7;var e={el:document.getElementById("notification")},f=PWG.Timer.create();f.start(v,function(a,c){c.el.parentNode&&c.el.parentNode.removeChild(c.el),b.notificationHolder.style.zIndex=-1,PWG.Timer.remove(f.id)},e,b)},b.setFarkleIcons=function(a){for(var c="",d={},e=0;e<a.currentFarkles;e++)d={right:C*(e+1)+B*e},c+=PWG.Utils.parseMarkup(PWG.SafariTemplates.PLAYER_FARKLES,d);b.farklesText.innerHTML=c},b.removeDice=function(a){PWG.Utils.each(a,function(c){b.removeDie(c,a)},this)},b.removeDie=function(a,b){a&&a.el&&(a.el.parentNode.removeChild(a.el),a.destroy(),delete b[a.id])},b.updateText=function(a,c,d,e){var f="";"turnScore"===a?f="turn":"totalScore"===a?f="game: ":"dealerSpeechTextEl"===a&&(b.dealerSpeech.style.display=""!==c?"block":"none"),this[a].innerHTML=f+c,d&&(this[a].className=e?d:" "+d)},b.updateTurnScore=function(a,c){b.updateText("turnScore",a.turns+": "+c)},b.minimumTurnScoreMet=function(){PWG.App.isTutorialActive?(PWG.App.tutorial.displayFirstMinimumTutorial&&(b.updateText("dealerSpeechTextEl",PWG.Tutorial.FIRST_MINIMUM),PWG.App.tutorial.displayFirstMinimumTutorial=!1),PWG.App.tutorial.isPresetRollsActive?(b.button2Callback=null,b.button2.style.opacity=.5):(PWG.App.tutorial.playRealGame&&(b.updateText("dealerSpeechTextEl",PWG.Tutorial.PLAY_REAL_GAME),PWG.App.tutorial.displayPlayRealGame=!1),b.button2.style.opacity=1)):(b.button2Callback=b.endTurn,b.button2.style.opacity=1),b.showButton(b.button2)},b.endTurn=function(){PWG.Games.endTurn(b.currentGameId)},b.onTurnEnded=function(a){PWG.App.isTutorialActive&&b.updateText("dealerSpeechTextEl",""),b.removeDice(b.rolledDice),b.rolledDice={},b.removeDice(b.selectedDice),b.selectedDice={},b.hideButton(b.button1),b.hideButton(b.button2),b.updateText("totalScore",a.score),b.setFarkleIcons(a)},b.gameOver=function(a){if(b.winner=a,!PWG.App.isTutorialActive&&(b.updateText("farklesText","winner!"," text_xl text_green text_right"),b.dealerPersonality&&(b.isEndingGame=!0,b.processDealerPersonality(!1,!1,!1,!0,a)),b.isTournamentGame))if(a instanceof PWG.AIPlayer)b.currentTournament=-1,b.isTournamentGame=!1,b.showNotification("elimination_notification"),b.isTournamentOver=!0;else{var c=PWG.Tournaments.getAll("tournaments"),d=c[b.tournamentKeys[b.currentTournament]];""!==d.champion&&a.name===d.userAnimal&&(b.displayTrophy=!0,b.isTournamentOver=!0)}b.hideButton(b.button1),b.updateButton("button2",l,!0),b.button2Class=l,b.button2Callback=PWG.App.quit,b.hideButton(b.button2)},b.setButton=function(a,c){a.innerHTML=c,b.showButton(a)},b.updateButton=function(a,c,d){var e=a+"Class",f=b[a];b.replaceClass(f,b[e],c),b[e]=c,d?b.hideButton(f):b.showButton(f)},b.hideButton=function(a){a.style.display="none"},b.showButton=function(a){a.style.display="block"},b.onButton1Click=function(){PWG.App.isTutorialActive&&b.showDealerSpeechBubble(!1),b.button1Callback.call(this)},b.onButton2Click=function(){null!==b.button2Callback&&(b.hideButton(b.button2),b.button2Callback.call(this))},b.openScreen=function(a,c,d){b.currentScreen!==a&&("play"!==b.currentScreen&&"home"!==b.currentScreen,b.currentScreen=a,b.screenEls[a].style.display="block",d||(b.screenEls[a].className+=D),c&&c.call(b))},b.closeScreen=function(a){var c=b.screenEls[a];b.removeClass(c,D);var d=document.getElementById(a+"_close_holder");switch(d&&d.parentNode.removeChild(d),c.style.display="none",a){case"rules":case"location":case"tournament":"tournament"===a&&(b.isTournamentGame=!1),b.screenEls.home.style.display="block",b.currentScreen="home";break;case"animal":b.isTournamentGame?b.isTournamentAnimalSelected||b.openScreen("tournament",b.onTournamentScreenOpened,!0):b.openScreen("location",b.onLocationSelectionScreenOpened,!0);break;case"bracket":b.screenEls.bracket.style.left="0px",b.isTournamentGame&&b.openScreen("tournament",b.onTournamentScreenOpened,!0);break;case"stats":b.currentScreen="play";break;case"play":b.isTournamentGame&&(document.getElementById("large_trophy").style.display="none",b.isTournamentOver&&(b.closeScreen("bracket"),b.closeScreen("tournament")));break;case"home":b.screenEls.welcome.style.display="block",document.getElementById("start_message").style.display="block",b.currentScreen="welcome"}b.closeCb&&(b.closeCb.call(b),b.closeCb=null)},b.removeClass=function(a,b){var c=a.className;c.indexOf(b)>-1&&(a.className=c.substr(0,c.indexOf(b)))},b.replaceClass=function(a,c,d){b.removeClass(a,c),-1===a.className.indexOf(d)&&(a.className+=d)},b.layout=function(){PWG.WindowParams.update(),b.updateSquareStyleEl(),PWG.WindowParams.isOrientationChanged&&PWG.StyleElManager.update(),PWG.GUIDice.updateSizes(),PWG.Games.isGUIGameActive&&(b.updateRectsAndSizes(),PWG.Utils.objLength(b.rolledDice)&&PWG.GUIDice.resizeDice(b.rolledDice,!0),PWG.Utils.objLength(b.selectedDice)&&PWG.GUIDice.resizeDice(b.selectedDice,!1))},b.updateSquareStyleEl=function(){var c={};"landscape"===PWG.WindowParams.orientation?(c.size=PWG.WindowParams.height,c.doubleSize=2*c.size,c.top=0,c.titleWidth=PWG.WindowParams.width-PWG.WindowParams.height,c.titleHeight=PWG.WindowParams.height):(c.size=PWG.WindowParams.width,c.doubleSize=2*c.size,c.top=PWG.WindowParams.height-PWG.WindowParams.width,c.titleWidth=PWG.WindowParams.width,c.titleHeight=PWG.WindowParams.height-PWG.WindowParams.width),a.removeChild(b.squareStyleEl),b.squareStyleEl.innerHTML=PWG.Utils.parseMarkup(F,c),a.appendChild(b.squareStyleEl)},b.updateRectsAndSizes=function(){PWG.GUIDice.playScreenRect=b.screenEls.play.getBoundingClientRect(),PWG.GUIDice.rollingGreenRect=b.rollingGreen.getBoundingClientRect(),PWG.GUIDice.bankRect=b.bankEl.getBoundingClientRect(),PWG.GUIDice.unit=Math.floor(b.screenEls.play.offsetWidth/100)},b.processDealerPersonality=function(a,c,d,e,f){var g;g=a?b.dealerPersonality.getTurnStartComment(b.currentGameId):e?b.dealerPersonality.getWinComment(f):b.dealerPersonality.getRollComment(b.currentGameId,c,d),""!==g&&(b.updateText("dealerSpeechTextEl",g),b.showDealerSpeechBubble(!0))},b.confirmQuit=function(a){PWG.App.isTutorialActive&&b.updateText("dealerSpeechTextEl",""),PWG.App.pause(b.currentGameId),b.isConfirmBoxOpen=!0,b.confirmQuitCb=a;var c=document.getElementById("confirm_box");c.style.display="block";var d=document.getElementById("cancel_button"),e=document.getElementById("confirm_button");d.addEventListener("click",b.onCancelQuitClicked),e.addEventListener("click",b.onConfirmQuitClicked)},b.onCancelQuitClicked=function(){PWG.App.resume(b.currentGameId),b.confirmQuitCb.call(this,!1),b.closeConfirmBox()},b.onConfirmQuitClicked=function(){b.confirmQuitCb.call(this,!0),b.closeConfirmBox()},b.closeConfirmBox=function(){var a=document.getElementById("confirm_box");a.style.display="none";var c=document.getElementById("cancel_button"),d=document.getElementById("confirm_button");c.removeEventListener("click",b.cancelQuit),d.removeEventListener("click",b.confirmQuit),b.isConfirmBoxOpen=!1},b.quit=function(a){b.removePlayerEls(),b.replaceClass(b.titleButton,d,c),b.removeDice(b.rolledDice),b.rolledDice={},b.removeDice(b.selectedDice),b.selectedDice={},b.bankEl.innerHTML="",b.button1Callback=a,b.updateButton("button1",h),b.button1Class=h,b.hideButton(b.button2),b.closeScreen("play"),b.isTournamentGame&&""!==b.currentTournament?b.openScreen("bracket",b.onBracketScreenOpened):(b.closeScreen("tournament"),b.closeScreen("animal"),b.closeScreen("location"),b.closeScreen("bracket"),b.openScreen("home",null,!0)),PWG.App.isTutorialActive&&b.updateText("dealerSpeechTextEl","tutorial active"),b.showDealerSpeechBubble(PWG.App.isTutorialActive)},b.houseKeeping=function(){b.removeEventListeners(),b.removeLocationChoiceClickHandlers(),b.removeAnimalChoiceClickHandlers()},b}();var PWG=PWG||{};PWG.Games=function(){"use strict";function a(a,b,c){this.isGUIGame=a,this.isTournamentGame=b,this.gameOverCallback=c,this.id=String(Date.now()+Math.floor(9999*Math.random())),this.isFirstTurn=!0,this.isActive=!1,this.isPaused=!1,this.rolledCallback={fn:this.onRolled,ctx:this},PWG.Farkle.initGame(this.id,this.rolledCallback)}var b={},c=500;b.isGUIGameActive=!1;var d={};return a.prototype.start=function(){this.isActive=!0,b.isGUIGameActive=this.isGUIGame,PWG.Players.startGame(this.id),this.isGUIGame&&PWG.App.gui.onGameStarted(PWG.Players.getAll(this.id)),this.totalTurns=1,this.startTurn()},a.prototype.startTurn=function(){if(!this.isPaused)if(this.isGUIGame&&!this.isFirstTurn){var a=PWG.Timer.create();a.start(b.TURN_DELAY_TIME,function(){return function(a){a.initializeTurn()}(this)},{},this)}else this.initializeTurn(),this.isFirstTurn=!1},a.prototype.initializeTurn=function(){PWG.Players.incrementTurn(this.id),PWG.Farkle.startTurn(this.id),PWG.Players.startTurn(this.id),PWG.Players.getIsAITurn(this.id)||this.startRoll(),this.isGUIGame&&(PWG.App.startTurn(this.id,PWG.Players.getIsAITurn(this.id)),PWG.App.gui.startTurn(PWG.Players.getCurrent(this.id)))},a.prototype.startRoll=function(){this.isGUIGame?PWG.App.gui.startRoll():this.selectedDice={}},a.prototype.roll=function(a,b){var c;this.isPaused||(c=PWG.App.isTutorialActive?PWG.Farkle.rollValues(this.id,PWG.App.tutorial.getPresetRoll()):b?PWG.Farkle.rollFarkle(this.id):a?PWG.Farkle.rollStraight(this.id):PWG.Farkle.roll(this.id)),this.isGUIGame&&(PWG.App.gui.displayRoll(c),PWG.App.gui.setSelectedCallback({fn:this.onDiceSelected,ctx:this})),PWG.Players.getIsAITurn(this.id)&&PWG.Players.setRolledDice(this.id,c),this.isActive&&c.farkled&&this.hasFarkled()},a.prototype.selectDice=function(a){this.isGUIGame?PWG.App.gui.selectDice(a):(this.selectedDice={},PWG.Utils.each(a,function(a){this.selectedDice[a.idx]=a.idx},this))},a.prototype.selectionComplete=function(){this.isGUIGame?PWG.App.gui.addDiceToBank():this.onDiceSelected(this.selectedDice)},a.prototype.onDiceSelected=function(a){var b=PWG.Farkle.getTurnDice(this.id),c=[];c=PWG.Farkle.bankScoringDice(this.id,a);var d=0;b.hotDice?PWG.Players.hasHotDice(this.id,!0):PWG.Players.hasHotDice(this.id,!1),c instanceof Array?PWG.Utils.each(c,function(a){d+=a},this):d=c,this.isGUIGame&&PWG.App.gui.updateTurnScore(PWG.Players.getCurrent(this.id),d),PWG.Players.getIsAITurn(this.id)&&PWG.Players.updateTurnScore(this.id,d,b.hotDice),d>=PWG.Farkle.MIN_TURN_SCORE&&(this.farkled=!1,this.isGUIGame&&PWG.App.gui.minimumTurnScoreMet()),this.startRoll()},a.prototype.hasFarkled=function(){this.farkled=!0,PWG.Players.hasFarkled(this.id),this.isGUIGame?PWG.App.gui.farkled(PWG.Players.getCurrent(this.id)):this.endTurn()},a.prototype.endTurn=function(){PWG.Players.onTurnEnded(this.id,this.farkled,PWG.Farkle.getTurnDice(this.id));var a=PWG.Players.getCurrent(this.id);this.isGUIGame&&PWG.App.gui.onTurnEnded(a),a.score>=PWG.Farkle.WINNING_SCORE||this.totalTurns>c?this.gameOver():this.nextTurn()},a.prototype.nextTurn=function(){PWG.Players.nextPlayer(this.id),this.totalTurns++,this.startTurn()},a.prototype.gameOver=function(){this.isActive=!1,b.gameOver(this.id,this.isGUIGame)},b.createGUIGame=function(a,c,d){return b.create(a,!0,c,d)},b.createNPCGame=function(a,c,d){return b.create(a,!1,c,d)},b.create=function(b,c,e,f){var g=new a(c,e,f),h=PWG.App.getData("players");return PWG.Players.create(g.id,b,h,c,e),PWG.App.isTutorialActive||PWG.App.savePlayerData(g.id),d[g.id]=g,g.id},b.start=function(a){d[a].start()},b.roll=function(a,b){d[a].roll(b)},b.rollFarkle=function(a){d[a].roll(!1,!0)},b.selectDice=function(a,b){d[a].selectDice(b)},b.selectionComplete=function(a){d[a].selectionComplete()},b.onDiceSelected=function(a,b){d[a].onDiceSelected(b)},b.endTurn=function(a){d[a].endTurn()},b.get=function(){return d},b.gameOver=function(a,c){b.isGUIGameActive=!1;var e=PWG.Players.gameOver(a);PWG.App.isTutorialActive?(PWG.App.isTutorialActive=!1,PWG.App.gui.gameOver()):PWG.App.savePlayerData(a);var f=d[a];if(f.gameOverCallback&&f.gameOverCallback.fn.call(f.gameOverCallback.ctx,a,e,f.isTournamentGame),c){var e=PWG.Players.getCurrent(a);PWG.App.gui.gameOver(e)}PWG.Players.quit(a),PWG.Farkle.quitGame(a),d[a]=null},b}();var PWG=PWG||{};PWG.Tournaments=function(){"use strict";function a(a){return this.id=a.id||String((new Date).getTime()),this.isInitialized=a.isInitialized||!1,this.rounds=a.rounds||{},this.currentRoundIndices=a.currentRoundIndices||{},this.locationChampions=a.locationChampions||{},this.champion=a.champion||"",this.userAnimal=a.userAnimal,this.userHome=a.userHome,this.isActive=!0,this.gameIds={},this.callback={fn:this.gameOverCallback,ctx:this},this.isInitialized||this.init(a.contenders),this.id}function b(a){for(var b=[];a.length>0;)b.push(a.splice(0,2));return b}function c(a,b){var c=-1;return PWG.Utils.each(a,function(a,d){PWG.Utils.each(a,function(a){a===b&&(c=d)},e)},e),c}function d(a){var b=PWG.App.getData("tournaments");f[a].isActive?b[a]=f[a].getData():b.hasOwnProperty(a)&&delete b[a],PWG.App.saveData("tournaments",b)}var e={};e.FINALS="finals";var f={};return a.prototype.init=function(a){PWG.Utils.each(a,function(a,b){this.initLocationRounds(a,b)},this),this.initFinalsRounds(),this.isInitialized=!0},a.prototype.initLocationRounds=function(a,b){var c=a.length;this.currentRoundIndices[b]=0,this.gameIds[b]=[],this.rounds[b]=[],this.rounds[b].push({numGames:c,completed:[],contenders:a}),this.createRounds(c,b),this.initRound(b)},a.prototype.initFinalsRounds=function(){this.rounds[e.FINALS]=[],this.currentRoundIndices[e.FINALS]=0,this.gameIds[e.FINALS]=[],this.createRounds(PWG.Animals.getLocationsLength(),e.FINALS)},a.prototype.createRounds=function(a,b){for(;a>1;)a/=2,this.rounds[b].push({completed:[],contenders:[]})},a.prototype.initRound=function(a){var b=this.currentRoundIndices[a],c=this.rounds[a][b],d=c.contenders;c.winners=c.winners||[],this.gameIds[a]=this.gameIds[a]||[],this.gameIds[a][b]=[],PWG.Utils.each(d,function(d){this.initGame(d,c,b,a)},this)},a.prototype.initGame=function(a,b,c,d){var e,f=!1,g={};PWG.Utils.each(a,function(a){var b=!0;a===this.userAnimal&&(f=!0,b=!1),g[a]={name:a,isAIPlayer:b}},this),f?(e=PWG.Games.createGUIGame(g,d,this.callback),this.currentUserGameId=b.userGameId=e):e=PWG.Games.createNPCGame(g,d,this.callback),this.gameIds[d][c]=this.gameIds[d][c]||[],this.gameIds[d][c].push(e)},a.prototype.reInitRounds=function(){var a=PWG.Animals.getLocationKeys(),b=this.locationChampions,c=PWG.Utils.objLength(b);0===c?this.init():c==a.length?this.initRound(e.FINALS):PWG.Utils.each(a,function(a){if(!b.hasOwnProperty(a)){var c=this.currentRoundIndices[a],d=this.rounds[a][c],e=d.completed,f=d.contenders;PWG.Utils.each(f,function(b,f){-1===e.indexOf(f)&&(this.gameIds[a]=this.gameIds[a]||[],this.initGame(b,d,c,a))},this)}},this)},a.prototype.startAllLocations=function(){PWG.Utils.each(this.rounds,function(a,b){b!==e.FINALS&&this.startRound(b)},this)},a.prototype.startRound=function(a){var b=this.currentRoundIndices[a],c=this.rounds[a][b],d=this.gameIds[a][b];PWG.Utils.each(d,function(a){a!=c.userGameId?PWG.Games.start(a):this.currentUserGameId=a},this)},a.prototype.gameOverCallback=function(a,f,g){var h=this.currentRoundIndices[g],i=this.rounds[g][h],j=c.call(this,i.contenders,f.name);i.completed.push(j),i.winners.push(f.name),h<this.rounds[g].length-1?i.completed.length===i.contenders.length&&(h++,this.rounds[g][h].contenders=b(PWG.Utils.clone(i.winners)),this.currentRoundIndices[g]=h,this.initRound(g),this.startRound(g)):g===e.FINALS?(this.champion=f.name,this.isActive=!1,PWG.Players.hasWonTournament(a),PWG.App.savePlayerData(a)):(this.locationChampions[g]=f.name,this.addContenderToEndRounds.call(this,f.name)),d(this.id)},a.prototype.addContenderToEndRounds=function(a){var c=this.rounds[e.FINALS],d=this.currentRoundIndices[e.FINALS],f=d,g=PWG.Animals.getLocationsLength(),h=c[d]||{};for(h.contenders=h.contenders||[],h.contenders.push(a),this.rounds[e.FINALS][d]=h;f>0;)g/=2,f--;h.contenders.length===g&&(h.contenders=b(h.contenders),h.completed=[],this.initRound(e.FINALS),this.startRound(e.FINALS))},a.prototype.getData=function(){return{id:this.id,isInitialized:this.isInitialized,isActive:this.isActive,location:this.location,userAnimal:this.userAnimal,userHome:this.userHome,rounds:this.rounds,currentRoundIndices:this.currentRoundIndices,locationChampions:this.locationChampions,champion:this.champion}},e.init=function(b){b&&PWG.Utils.each(b,function(b){b.isActive&&(b=new a(b),b.reInitRounds(),f[b.id]=b)},e)},e.create=function(c){var g,h={userAnimal:c,userHome:PWG.PlayerAnimalHomes[c]},i={};return PWG.Utils.each(PWG.Animals.locations,function(a,d){var e=PWG.Utils.clone(a);d===PWG.PlayerAnimalHomes[c]&&(e.pop(),e.push(c)),e=PWG.Utils.shuffle(e),i[d]=b(e)},e),h.contenders=i,g=new a(h),f[g.id]=g,d(g.id),g.id},e.start=function(a){f.hasOwnProperty(a)&&f[a].startAllLocations()},e.getUserGameId=function(a){return f.hasOwnProperty(a)?f[a].currentUserGameId:void 0},e.getAll=function(){return f},e.getActive=function(){var a={};return PWG.Utils.each(f,function(b,c){b.isActive&&(a[c]=b)},e),a},e.getActiveAnimals=function(){var a=[];return PWG.Utils.each(f,function(b){b.isActive&&a.push(b.userAnimal)},e),a},e.kill=function(a){f.hasOwnProperty(a)&&(f[a]=null,delete f[a])},e}();var PWG=PWG||{};PWG.App=function(){"use strict";function a(a){c.length>0&&PWG.Utils.each(c,function(b){b.fn.call(b.ctx,a)},b)}var b={},c=[];return b.DELAY_TIME=1500,b.TURN_DELAY_TIME=500,b.name="pwg_farkle_safari",b.isTournamentGame=!1,b.isTutorialActive=!1,b.isPaused=!1,b.tutorial=null,b.init=function(a){if(b.isMobile=PWG.DeviceUtils.isMobile(),b.isAndroid=PWG.DeviceUtils.isAndroid(),b.gui=a.gui,b.soundFX=a.soundFX||!1,PWG.Personalities.init(),PWG.User.init(b.onGameDataLoaded,b.name),a.adSystem){var d=PWG.AdManager.create(a.adSystem.type,a.adSystem.config);d&&c.push({fn:d.callback,ctx:d})}},b.onGameDataLoaded=function(){b.gui.init(),PWG.Tournaments.init(PWG.User.getData().tournaments)},b.startGame=function(c){a({type:PWG.GameEvents.GAME_STARTED,id:c}),b.isTutorialActive&&(b.tutorial=new PWG.Tutorial),PWG.Games.start(c)},b.startTurn=function(b,c){a({type:PWG.GameEvents.TURN_STARTED,userTurn:!c})},b.pause=function(a){PWG.Players.pause(a)},b.resume=function(a){PWG.Players.resume(a)},b.getIsFirstPlay=function(){return PWG.User.get("isFirstPlay")},b.setIsFirstPlay=function(a){PWG.User.set("isFirstPlay",a)},b.getData=function(a){return PWG.User.get(a)},b.saveData=function(a,b){PWG.User.set(a,b)},b.savePlayerData=function(a){var b=PWG.Players.getAllPlayerStats(a);PWG.User.set("players",b)},b.quit=function(){PWG.Games.isGUIGameActive?b.isTutorialActive?b.confirmQuit(!0):b.gui.confirmQuit(b.confirmQuit):b.confirmQuit(!0)},b.confirmQuit=function(a){a&&(b.tutorial&&(b.tutorial=null),b.isTutorialActive=!1,b.gui.quit(b.createGame))},b}();
//# sourceMappingURL=farkle.min.js.map